"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[47076],{10469:function(e,t,n){n.d(t,{$:function(){return o}});var r=n(64782),o=(n(89655),function(e,t){var n,o={},a=(0,r.A)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=t(i);s in o?o[s].push(i):o[s]=[i]}}catch(u){a.e(u)}finally{a.f()}return o})},47076:function(e,t,n){var r=n(22858).A,o=n(33994).A;n.a(e,function(){var e=r(o().mark((function e(r,a){var i,s,u,c,f,l,_,y,g,p,m,d,v,h,b,w,A,k,T,x,D,E,W,C,S,O,P,j,z,B,L,M,N,$,H,I,K,R,V,X,q,G,J,Q,U,F,Y,Z,ee,te,ne,re,oe,ae,ie,se,ue,ce,fe,le,_e,ye,ge,pe,me,de,ve,he,be,we,Ae,ke,Te;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.d(t,{AN:function(){return fe},B2:function(){return ae},BV:function(){return oe},DR:function(){return ke},E$:function(){return ce},GW:function(){return re},KJ:function(){return ve},Q4:function(){return ee},RB:function(){return Y},WN:function(){return se},X4:function(){return be},_d:function(){return de},al:function(){return pe},bs:function(){return ie},c:function(){return ne},gv:function(){return we},m7:function(){return F},oU:function(){return te},tb:function(){return ge},uh:function(){return Z},yM:function(){return he}}),i=n(658),s=n(41981),u=n(64782),c=n(33994),f=n(22858),l=n(71499),_=n(81027),y=n(82386),g=n(95737),p=n(97741),m=n(89655),d=n(26098),v=n(99471),h=n(10507),b=n(39790),w=n(9241),A=n(66457),k=n(36604),T=n(99019),x=n(92765),D=n(253),E=n(54846),W=n(16891),C=n(66555),S=n(96858),O=n(31195),P=n(77301),j=n(91103),z=n(39902),B=n(72730),L=n(61310),M=n(31293),N=n(63165),$=n(60132),H=n(83324),I=n(84280),K=n(94100),R=n(78691),V=n(41924),X=n(10469),q=n(31265),G=n(4826),!(J=r([R,V])).then){e.next=72;break}return e.next=68,J;case 68:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=73;break;case 72:e.t0=J;case 73:Q=e.t0,R=Q[0],V=Q[1],U=[],F=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},Y=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},Z=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},ee=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},te=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},ne=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},re=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},oe=function(e){return e.callWS({type:"energy/info"})},ae=function(){var e=(0,f.A)((0,c.A)().mark((function e(t){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(e){return e.callWS({type:"energy/get_prefs"})},se=function(){var e=(0,f.A)((0,c.A)().mark((function e(t,n){var r;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),_e(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){var e=(0,f.A)((0,c.A)().mark((function e(t,n,r,o,a){var i,s=arguments;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>5&&void 0!==s[5]?s[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==a?void 0:a.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:i}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,a){return e.apply(this,arguments)}}(),ce=function(e){return(0,X.$)(e.energy_sources,(function(e){return e.type}))},fe=function(e,t,n){var r,o=[],a=(0,u.A)(e.energy_sources);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!n||n.includes(i.type))if("solar"!==i.type)if("gas"!==i.type&&"water"!==i.type)if("battery"!==i.type){var c,f=(0,u.A)(i.flow_from);try{for(f.s();!(c=f.n()).done;){var l=c.value;o.push(l.stat_energy_from),l.stat_cost&&o.push(l.stat_cost);var _=t.cost_sensors[l.stat_energy_from];_&&o.push(_)}}catch(v){f.e(v)}finally{f.f()}var y,g=(0,u.A)(i.flow_to);try{for(g.s();!(y=g.n()).done;){var p=y.value;o.push(p.stat_energy_to),p.stat_compensation&&o.push(p.stat_compensation);var m=t.cost_sensors[p.stat_energy_to];m&&o.push(m)}}catch(v){g.e(v)}finally{g.f()}}else o.push(i.stat_energy_from),o.push(i.stat_energy_to);else{o.push(i.stat_energy_from),i.stat_cost&&o.push(i.stat_cost);var d=t.cost_sensors[i.stat_energy_from];d&&o.push(d)}else o.push(i.stat_energy_from)}}catch(v){a.e(v)}finally{a.f()}return n&&!n.includes("device")||o.push.apply(o,(0,s.A)(e.device_consumption.map((function(e){return e.stat_consumption})))),o},le=function(){var e=(0,f.A)((0,c.A)().mark((function e(t,n,r,o,a){var f,l,_,y,g,p,m,d,v,h,b,w,A,k,T,x,D,E,W,C,S,N,$,H,I,K,V,X,J,Q,U,F,Y,Z,ee,te,ne,re,ae,ie,se,ce,le,_e,ye,ge,pe;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,q.VN)(t,{domain:"co2signal"}),oe(t)]);case 2:if(f=e.sent,l=(0,i.A)(f,2),_=l[0],y=l[1],!(g=_.length?_[0]:void 0)){e.next=21;break}m=0,d=Object.values(t.entities);case 9:if(!(m<d.length)){e.next=21;break}if("co2signal"===(v=d[m]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((h=t.states[v.entity_id])&&"%"===h.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return p=h.entity_id,e.abrupt("break",21);case 18:m++,e.next=9;break;case 21:b=[],w=(0,u.A)(n.energy_sources);try{for(w.s();!(A=w.n()).done;)if("grid"===(k=A.value).type){T=(0,u.A)(k.flow_from);try{for(T.s();!(x=T.n()).done;)D=x.value,b.push(D.stat_energy_from)}catch(c){T.e(c)}finally{T.f()}}}catch(c){w.e(c)}finally{w.f()}return E=fe(n,y,["grid","solar","battery","gas","device"]),W=fe(n,y,["water"]),C=[].concat((0,s.A)(E),(0,s.A)(W)),S=(0,O.c)(o||new Date,r),N=S>35?"month":S>2?"day":"hour",$=t.config.unit_system.length||"",H={energy:"kWh",volume:"km"===$?"m続":"ft続"},I={volume:"km"===$?"L":"gal"},K=E.length?(0,G.sz)(t,r,o,E,N,H,["change"]):{},V=W.length?(0,G.sz)(t,r,o,W,N,I,["change"]):{},U={},F={},a&&(J=(0,R.xo)(r,P.e,t.locale,t.config)&&(0,R.xo)(o||new Date,j.c,t.locale,t.config)?(0,R.ol)(r,z.P,t.locale,t.config,-(0,R.EO)(o||new Date,r,B.W,t.locale,t.config)-1):(0,R.ol)(r,L.f,t.locale,t.config,-1*(S+1)),Q=(0,M.A)(r,-1),E.length&&(U=(0,G.sz)(t,J,Q,E,N,H,["change"])),W.length&&(F=(0,G.sz)(t,J,Q,W,N,I,["change"]))),void 0!==p&&(Y=ue(t,r,b,p,o,S>35?"month":S>2?"day":"hour"),a&&(Z=ue(t,J,b,p,Q,S>35?"month":S>2?"day":"hour"))),ee={},te=C.length?(0,G.Wr)(t,C):[],e.next=42,Promise.all([K,V,U,F,te,Y,Z]);case 42:return ne=e.sent,re=(0,i.A)(ne,7),ae=re[0],ie=re[1],se=re[2],ce=re[3],le=re[4],_e=re[5],ye=re[6],ge=Object.assign(Object.assign({},ae),ie),a&&(X=Object.assign(Object.assign({},se),ce)),C.length&&le.forEach((function(e){ee[e.statistic_id]=e})),pe={start:r,end:o,startCompare:J,endCompare:Q,info:y,prefs:n,stats:ge,statsMetadata:ee,statsCompare:X,co2SignalConfigEntry:g,co2SignalEntity:p,fossilEnergyConsumption:_e,fossilEnergyConsumptionCompare:ye},e.abrupt("return",pe);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,a){return e.apply(this,arguments)}}(),_e=function(e){U.forEach((function(t){var n=ge(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},ye=function(e){if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){var t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((function(){return e.refresh()}),t.getTime()-Date.now())}},ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];U.push(t.key);var r=(0,I.X)(e.connection,n,(0,f.A)((0,c.A)().mark((function t(){return(0,c.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,ie(e);case 3:r.prefs=t.sent;case 4:return ye(r),t.abrupt("return",le(e,r.prefs,r.start,r.end,r.compare));case 6:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,void 0===r._refreshTimeout&&ye(r),function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var a=new Date,i=(0,V.LW)(a,e.locale,e.config).split(":")[0];r.start=(0,R.ol)("0"===i?(0,L.f)(a,-1):a,N.o,e.locale,e.config),r.end=(0,R.ol)("0"===i?(0,L.f)(a,-1):a,$.D,e.locale,e.config);var s=function(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,R.ol)(new Date,N.o,e.locale,e.config),r.end=(0,R.ol)(new Date,$.D,e.locale,e.config),s()}),(0,H.L)((0,R.ol)(a,$.D,e.locale,e.config),1).getTime()-Date.now())};return s(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var o;r.start=t,r.end=n,r.start.getTime()!==(0,R.ol)(new Date,N.o,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,R.ol)(new Date,$.D,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):s()},r.setCompare=function(e){r.compare=e},r},pe=function(e){return e.callWS({type:"energy/solar_forecast"})},me=["volume","energy"],de=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,u.A)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var a=t.value;if("gas"===a.type&&(!r||r!==a.stat_energy_from)){var i=n[a.stat_energy_from];if(me.includes(null==i?void 0:i.unit_class))return i.unit_class}}}catch(s){o.e(s)}finally{o.f()}},ve=function(e,t){var n=de(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},he=function(e){return"km"===e.config.unit_system.length?"L":"gal"},be="/docs/energy/faq/#troubleshooting-missing-entities",we=(0,K.A)((function(e){return{summedData:Ae(e),compareSummedData:e.statsCompare?Ae(e,!0):void 0}})),Ae=function(e,t){var n,r={},o=(0,u.A)(e.prefs.energy_sources);try{for(o.s();!(n=o.n()).done;){var a=n.value;if("solar"!==a.type)if("battery"!==a.type){if("grid"===a.type){var s,c=(0,u.A)(a.flow_from);try{for(c.s();!(s=c.n()).done;){var f=s.value;r.from_grid?r.from_grid.push(f.stat_energy_from):r.from_grid=[f.stat_energy_from]}}catch(p){c.e(p)}finally{c.f()}var l,_=(0,u.A)(a.flow_to);try{for(_.s();!(l=_.n()).done;){var y=l.value;r.to_grid?r.to_grid.push(y.stat_energy_to):r.to_grid=[y.stat_energy_to]}}catch(p){_.e(p)}finally{_.f()}}}else r.to_battery?(r.to_battery.push(a.stat_energy_to),r.from_battery.push(a.stat_energy_from)):(r.to_battery=[a.stat_energy_to],r.from_battery=[a.stat_energy_from]);else r.solar?r.solar.push(a.stat_energy_from):r.solar=[a.stat_energy_from]}}catch(p){o.e(p)}finally{o.f()}var g={};return Object.entries(r).forEach((function(n){var r=(0,i.A)(n,2),o=r[0],a=r[1],s={},u={};a.forEach((function(n){var r=t?e.statsCompare[n]:e.stats[n];if(r){r.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;s[e.start]=e.start in s?s[e.start]+t:t}})),u[n]={}}})),g[o]=s})),g},ke=(0,K.A)((function(e,t){return{consumption:Te(e),compareConsumption:t?Te(t):void 0}})),Te=function(e){var t={total:{}};return Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(n){if(void 0===t.total[n]){var r,o,a,i,s,u=((null===(r=e.from_grid)||void 0===r?void 0:r[n])||0)+((null===(o=e.solar)||void 0===o?void 0:o[n])||0)+((null===(a=e.from_battery)||void 0===a?void 0:a[n])||0)-((null===(i=e.to_grid)||void 0===i?void 0:i[n])||0)-((null===(s=e.to_battery)||void 0===s?void 0:s[n])||0);t.total[n]=u}}))})),t},a(),e.next=111;break;case 108:e.prev=108,e.t2=e.catch(0),a(e.t2);case 111:case"end":return e.stop()}}),e,null,[[0,108]])})));return function(t,n){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=47076.Hp0M1q8bvlk.js.map