"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[14511],{14511:function(t,e,a){var i=a(22858).A,s=a(33994).A;a.a(t,function(){var t=i(s().mark((function t(i,n){var r,o,d,c,h,u,l,p,f,k,y,m,v,_,g,x,b,A,D,w,T,M,S,E,Z,I,O,L,z,F,U,C,q,j,P,Y,B,H,R,W,J,Q,V,$,G,K,N,X,tt,et;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a.d(e,{n:function(){return et}}),r=a(658),o=a(41981),d=a(33994),c=a(22858),h=a(64599),u=a(35806),l=a(71008),p=a(62193),f=a(2816),k=a(27927),y=a(81027),m=a(82386),v=a(95737),_=a(97741),g=a(89655),x=a(33231),b=a(99471),A=a(10507),D=a(39790),w=a(74268),T=a(24545),M=a(51855),S=a(82130),E=a(31743),Z=a(22328),I=a(4959),O=a(62435),L=a(36604),z=a(99019),F=a(253),U=a(54846),C=a(16891),q=a(66555),j=a(96858),P=a(50289),Y=a(29818),B=a(94100),H=a(46999),R=a(33922),W=a(34897),J=a(57636),Q=a(4826),a(90701),V=a(56136),!($=i([J])).then){t.next=78;break}return t.next=74,$;case 74:t.t1=t.sent,t.t0=(0,t.t1)(),t.next=79;break;case 78:t.t0=$;case 79:J=t.t0[0],et={mean:"mean",min:"min",max:"max",sum:"sum",state:"sum",change:"sum"},(0,k.A)([(0,Y.EM)("statistics-chart")],(function(t,e){var a,i=function(e){function a(){var e;(0,l.A)(this,a);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return e=(0,p.A)(this,a,[].concat(s)),t(e),e}return(0,f.A)(a,e),(0,u.A)(a)}(e);return{F:i,d:[{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"statisticsData",value:void 0},{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"metadata",value:void 0},{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"names",value:void 0},{kind:"field",decorators:[(0,Y.MZ)()],key:"unit",value:void 0},{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"endTime",value:void 0},{kind:"field",decorators:[(0,Y.MZ)({type:Array})],key:"statTypes",value:function(){return["sum","min","mean","max"]}},{kind:"field",decorators:[(0,Y.MZ)()],key:"chartType",value:function(){return"line"}},{kind:"field",decorators:[(0,Y.MZ)({type:Boolean})],key:"hideLegend",value:function(){return!1}},{kind:"field",decorators:[(0,Y.MZ)({type:Boolean})],key:"logarithmicScale",value:function(){return!1}},{kind:"field",decorators:[(0,Y.MZ)({type:Boolean})],key:"isLoadingData",value:function(){return!1}},{kind:"field",decorators:[(0,Y.MZ)({type:Boolean})],key:"clickForMoreInfo",value:function(){return!0}},{kind:"field",decorators:[(0,Y.MZ)()],key:"period",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,Y.wk)()],key:"_chartDatasetExtra",value:function(){return[]}},{kind:"field",decorators:[(0,Y.wk)()],key:"_statisticIds",value:function(){return[]}},{kind:"field",decorators:[(0,Y.wk)()],key:"_chartOptions",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_hiddenStats",value:function(){return new Set}},{kind:"field",decorators:[(0,Y.P)("ha-chart-base")],key:"_chart",value:void 0},{kind:"field",key:"_computedStyle",value:void 0},{kind:"field",key:"resize",value:function(){var t=this;return function(e){var a;null===(a=t._chart)||void 0===a||a.resize(e)}}},{kind:"method",key:"shouldUpdate",value:function(t){return t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){t.has("legendMode")&&this._hiddenStats.clear(),(!this.hasUpdated||t.has("unit")||t.has("period")||t.has("chartType")||t.has("logarithmicScale")||t.has("hideLegend"))&&this._createOptions(),(t.has("statisticsData")||t.has("statTypes")||t.has("chartType")||t.has("hideLegend")||t.has("_hiddenStats"))&&this._generateData()}},{kind:"method",key:"firstUpdated",value:function(){this._computedStyle=getComputedStyle(this)}},{kind:"method",key:"render",value:function(){return(0,R.x)(this.hass,"history")?this.isLoadingData&&!this.statisticsData?(0,P.qy)(K||(K=(0,h.A)(['<div class="info"> '," </div>"])),this.hass.localize("ui.components.statistics_charts.loading_statistics")):this.statisticsData&&Object.keys(this.statisticsData).length?(0,P.qy)(X||(X=(0,h.A)([' <ha-chart-base externalHidden .hass="','" .data="','" .extraData="','" .options="','" .chartType="','" @dataset-hidden="','" @dataset-unhidden="','"></ha-chart-base> '])),this.hass,this._chartData,this._chartDatasetExtra,this._chartOptions,this.chartType,this._datasetHidden,this._datasetUnhidden):(0,P.qy)(N||(N=(0,h.A)(['<div class="info"> '," </div>"])),this.hass.localize("ui.components.statistics_charts.no_statistics_found")):(0,P.qy)(G||(G=(0,h.A)(['<div class="info"> '," </div>"])),this.hass.localize("ui.components.history_charts.history_disabled"))}},{kind:"method",key:"_datasetHidden",value:function(t){t.stopPropagation(),this._hiddenStats.add(this._statisticIds[t.detail.index]),this.requestUpdate("_hiddenStats")}},{kind:"method",key:"_datasetUnhidden",value:function(t){t.stopPropagation(),this._hiddenStats.delete(this._statisticIds[t.detail.index]),this.requestUpdate("_hiddenStats")}},{kind:"method",key:"_createOptions",value:function(t){var e=this;this._chartOptions={parsing:!1,animation:!1,interaction:{mode:"nearest",axis:"x"},scales:{x:{type:"time",adapters:{date:{locale:this.hass.locale,config:this.hass.config}},ticks:{source:"bar"===this.chartType?"data":void 0,maxRotation:0,sampleSize:5,autoSkipPadding:20,major:{enabled:!0},font:function(t){return t.tick&&t.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:"datetime",unit:"bar"===this.chartType&&this.period&&["hour","day","week","month"].includes(this.period)?this.period:void 0}},y:{beginAtZero:"bar"===this.chartType,ticks:{maxTicksLimit:7},title:{display:t||this.unit,text:t||this.unit},type:this.logarithmicScale?"logarithmic":"linear"}},plugins:{tooltip:{callbacks:{label:function(t){return"".concat(t.dataset.label,": ").concat((0,J.ZV)(t.parsed.y,e.hass.locale,(0,J.ZQ)(void 0,e.hass.entities[e._statisticIds[t.datasetIndex]]))," ").concat(t.dataset.unit||"")}}},filler:{propagate:!0},legend:{display:!this.hideLegend,labels:{usePointStyle:!0}}},elements:{line:{tension:.4,cubicInterpolationMode:"monotone",borderWidth:1.5},bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,J.Yf)(this.hass.locale),onClick:function(t){if(e.clickForMoreInfo&&!(0,V.a)(t)){var a=t.chart,i=a.getElementsAtEventForMode(t,"nearest",{intersect:!0},!0);if(i.length){var s=i[0],n=e._statisticIds[s.datasetIndex];(0,Q.OQ)(n)||((0,W.r)(e,"hass-more-info",{entityId:n}),a.canvas.dispatchEvent(new Event("mouseout")))}}}}}},{kind:"field",key:"_getStatisticsMetaData",value:function(){var t=this;return(0,B.A)(function(){var e=(0,c.A)((0,d.A)().mark((function e(a){var i,s;return(0,d.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Q.Wr)(t.hass,a);case 2:return i=e.sent,s={},i.forEach((function(t){s[t.statistic_id]=t})),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{kind:"method",key:"_generateData",value:(a=(0,c.A)((0,d.A)().mark((function t(){var e,a,i,s,n,c,h,u,l=this;return(0,d.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.statisticsData){t.next=2;break}return t.abrupt("return");case 2:if(t.t0=this.metadata,t.t0){t.next=7;break}return t.next=6,this._getStatisticsMetaData(Object.keys(this.statisticsData));case 6:t.t0=t.sent;case 7:if(e=t.t0,a=0,i=Object.entries(this.statisticsData),s=[],n=[],c=[],0!==i.length){t.next=15;break}return t.abrupt("return");case 15:(this.endTime||new Date(Math.max.apply(Math,(0,o.A)(i.map((function(t){var e=(0,r.A)(t,2),a=(e[0],e[1]);return new Date(a[a.length-1].start).getTime()}))))))>new Date&&new Date,u=this.names||{},i.forEach((function(t){var i=(0,r.A)(t,2),d=i[0],p=i[1],f=null==e?void 0:e[d],k=u[d];void 0===k&&(k=(0,Q.$O)(l.hass,d,f)),l.unit||(void 0===h?h=(0,Q.JE)(l.hass,d,f):null!==h&&h!==(0,Q.JE)(l.hass,d,f)&&(h=null));var y,m=null,v=[],_=[],g=(0,H.fI)(a,l._computedStyle||getComputedStyle(l));a++;var x=[],b=l.statTypes.includes("mean")&&(0,Q.iY)(p,"mean"),A=b||l.statTypes.includes("min")&&(0,Q.iY)(p,"min")&&l.statTypes.includes("max")&&(0,Q.iY)(p,"max"),D=A?(0,o.A)(l.statTypes).sort((function(t,e){return"min"===t||"max"===e?-1:"max"===t||"min"===e?1:0})):l.statTypes,w=!1;D.forEach((function(t){if((0,Q.iY)(p,t)){var e=A&&("min"===t||"max"===t);if(!l.hideLegend){var a=b?"mean"===t:!1===w;_.push({legend_label:k,show_legend:a}),w=w||a}x.push(t),v.push({label:k?"".concat(k," (").concat(l.hass.localize("ui.components.statistics_charts.statistic_types.".concat(t)),")\n            "):l.hass.localize("ui.components.statistics_charts.statistic_types.".concat(t)),fill:!!A&&("min"===t&&b?"+1":"max"===t&&"-1"),borderColor:e&&b?g+(l.hideLegend?"00":"7F"):g,backgroundColor:e?g+"3F":g+"7F",pointRadius:0,hidden:!l.hideLegend&&l._hiddenStats.has(d),data:[],unit:null==f?void 0:f.unit_of_measurement,band:e}),c.push(d)}}));var T=null,M=null;p.forEach((function(t){var e=new Date(t.start);if(T!==e){T=e;var a=[];x.forEach((function(e){var i,s;"sum"===e?null==M?(s=0,M=t.sum):s=(t.sum||0)-M:s=t[e],a.push(null!==(i=s)&&void 0!==i?i:null)})),function(t,e,a){a&&(t>e||(v.forEach((function(e,i){"line"===l.chartType&&y&&m&&y.getTime()!==t.getTime()&&(e.data.push({x:y.getTime(),y:m[i]}),e.data.push({x:y.getTime(),y:null})),e.data.push({x:t.getTime(),y:a[i]})})),m=a,y=e))}(e,new Date(t.end),a)}})),Array.prototype.push.apply(s,v),Array.prototype.push.apply(n,_)})),h&&this._createOptions(h),this._chartData={datasets:s},this._chartDatasetExtra=n,this._statisticIds=c;case 23:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,P.AH)(tt||(tt=(0,h.A)([":host{display:block;min-height:60px}.info{text-align:center;line-height:60px;color:var(--secondary-text-color)}"])))}}]}}),P.WF),n(),t.next=88;break;case 85:t.prev=85,t.t2=t.catch(0),n(t.t2);case 88:case"end":return t.stop()}}),t,null,[[0,85]])})));return function(e,a){return t.apply(this,arguments)}}())}}]);
//# sourceMappingURL=14511.j1eK9Km21II.js.map