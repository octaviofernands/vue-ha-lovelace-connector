"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[16204],{77226:function(e,t,a){a.d(t,{A:function(){return r}});a(71499),a(28552),a(36016),a(55228),a(43037);var i=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("".concat(e," is not a number"));return t};function r(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:i(e.substr(0,e.length-1))};var t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:i(t[0]),h:1}:{w:i(t[0]),h:i(t[1])}}catch(a){}return null}},9755:function(e,t,a){a.d(t,{e:function(){return i}});a(81027);var i=function(e){return"/api/image_proxy/".concat(e.entity_id,"?token=").concat(e.attributes.access_token,"&state=").concat(e.state)}},16204:function(e,t,a){var i,r,s,n,o,d,h=a(33994),c=a(22858),l=a(64599),u=a(35806),m=a(71008),v=a(62193),g=a(2816),k=a(27927),_=a(35890),f=(a(81027),a(13025),a(82386),a(82115),a(39790),a(36604),a(253),a(2075),a(50289)),p=a(29818),I=a(85323),y=a(55165),b=a(94872),w=a(213),S=a(77226),A=(a(6188),a(32885),a(88800)),C=a(9883),M=a(9755),U=function(e){return e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error",e}(U||{});(0,k.A)([(0,p.EM)("hui-image")],(function(e,t){var a,k,x,L,O=function(t){function a(){var t;(0,m.A)(this,a);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return t=(0,v.A)(this,a,[].concat(r)),e(t),t}return(0,g.A)(a,t),(0,u.A)(a)}(t);return{F:O,d:[{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"image",value:void 0},{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_imageVisible",value:function(){return!1}},{kind:"field",decorators:[(0,p.wk)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:function(){return null}},{kind:"method",key:"connectedCallback",value:function(){(0,_.A)(O,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=U.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,_.A)(O,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(e){if(e.has("hass")){var t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=U.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,S.A)(this.aspectRatio):null),this._loadState!==U.Loading||this.cameraImage||(this._loadState=U.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return f.s6;var e,t,a=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),d=this.entity?this.hass.states[this.entity]:void 0,h=d?d.state:C.Hh,c=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?t=this.hass.states[this.cameraImage]:e=this._cameraImageSrc;else if(this.stateImage){var u=this.stateImage[h];u?e=u:(e=this.image,c=!0)}else e=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:d&&"image"===(0,w.m)(d.entity_id)?(0,M.e)(d):this.image;e&&(e=this.hass.hassUrl(e));var m=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(m+=this.darkModeFilter),this.stateFilter&&this.stateFilter[h]&&(m+=this.stateFilter[h]),!m&&this.entity)&&(m=(!d||b.jj.includes(h))&&c?"grayscale(100%)":"");return(0,f.qy)(i||(i=(0,l.A)([' <div style="','" class="container ','"> '," "," </div> "])),(0,y.W)({paddingBottom:a?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:a&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:this._loadState===U.Loaded||"live"===this.cameraView?m:void 0}),(0,I.H)({ratio:a||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,f.qy)(r||(r=(0,l.A)([' <ha-camera-stream muted .hass="','" .stateObj="','" @load="','"></ha-camera-stream> '])),this.hass,t,this._onVideoLoad):void 0===e?f.s6:(0,f.qy)(s||(s=(0,l.A)([' <img id="image" src="','" @error="','" @load="','" style="','"> '])),e,this._onImageError,this._onImageLoad,(0,y.W)({display:a||this._loadState===U.Loaded?"block":"none"})),this._loadState===U.Error?(0,f.qy)(n||(n=(0,l.A)(['<div id="brokenImage" style="','"></div>'])),(0,y.W)({height:a?void 0:"".concat(this._lastImageHeight,"px")||0})):"live"===this.cameraView||void 0!==e&&this._loadState!==U.Loading?"":(0,f.qy)(o||(o=(0,l.A)(['<div class="progress-container" style="','"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>'])),(0,y.W)({height:a?void 0:"".concat(this._lastImageHeight,"px")||0})))}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){var e=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((function(){return e._updateCameraImageSrcAtInterval()}),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=U.Error}},{kind:"method",key:"_onImageLoad",value:(L=(0,c.A)((0,h.A)().mark((function e(t){var a;return(0,h.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=U.Loaded,a=t.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=a.src),e.next=5,this.updateComplete;case 5:this._lastImageHeight=a.offsetHeight;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{kind:"method",key:"_onVideoLoad",value:(x=(0,c.A)((0,h.A)().mark((function e(t){var a;return(0,h.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=U.Loaded,a=t.currentTarget,e.next=4,this.updateComplete;case 4:this._lastImageHeight=a.offsetHeight;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:(k=(0,c.A)((0,h.A)().mark((function e(){return(0,h.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState===U.Loading&&this._onImageError(),e.abrupt("return",this._updateCameraImageSrc());case 2:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrc",value:(a=(0,c.A)((0,h.A)().mark((function e(){var t,a,i;return(0,h.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hass&&this.cameraImage){e.next=2;break}return e.abrupt("return");case 2:if(this.hass.states[this.cameraImage]){e.next=6;break}return this._onImageError(),e.abrupt("return");case 6:return t=this.clientWidth||640,a=Math.ceil(t*devicePixelRatio),this._lastImageHeight?i=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?i=Math.ceil(a*(this._ratio.h/this._ratio.w)):(a*=2,i=Math.ceil(.5625*a)),e.next=11,(0,A.C4)(this.hass,this.cameraImage,a,i);case 11:this._cameraImageSrc=e.sent,void 0===this._cameraImageSrc&&this._onImageError();case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,f.AH)(d||(d=(0,l.A)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}'])))}}]}}),f.WF)}}]);
//# sourceMappingURL=16204.2RG0KnctOrY.js.map