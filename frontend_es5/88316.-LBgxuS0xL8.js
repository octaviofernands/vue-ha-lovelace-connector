"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[88316],{88316:function(e,t,n){var i=n(22858).A,r=n(33994).A;n.a(e,function(){var e=i(r().mark((function e(t,i){var s,o,a,u,c,d,l,h,k,f,v,b,g,_,p,m,y,w,A,E,x,M,T,I,L,S,B,C,U,Z,N,z,D,P,R,q,O,G,j,F,Q,H,W,J;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=n(64782),o=n(41981),a=n(33994),u=n(22858),c=n(64599),d=n(35806),l=n(71008),h=n(62193),k=n(2816),f=n(27927),v=n(35890),b=n(71499),g=n(81027),_=n(13025),p=n(82386),m=n(89655),y=n(53165),w=n(33231),A=n(50693),E=n(39790),x=n(9241),M=n(36604),T=n(253),I=n(2075),L=n(54846),S=n(4525),B=n(66555),C=n(50289),U=n(29818),Z=n(33922),N=n(65459),z=n(58034),n(32885),D=n(78573),P=n(38545),R=n(71443),q=n(61558),!(O=t([q])).then){e.next=62;break}return e.next=58,O;case 58:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=63;break;case 62:e.t0=O;case 63:q=e.t0[0],W=function(e,t){return new Date(e.getTime()-1e3*t).getTime()/1e3},J=function(e,t){return(void 0!==e||void 0!==t)&&(!e||!t||e.length!==t.length||e.some((function(e){return!t.includes(e)}))||t.some((function(t){return!e.includes(t)})))},(0,f.A)([(0,U.EM)("ha-logbook")],(function(e,t){var n,i,r=function(t){function n(){var t;(0,l.A)(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return t=(0,h.A)(this,n,[].concat(r)),e(t),t}return(0,k.A)(n,t),(0,d.A)(n)}(t);return{F:r,d:[{kind:"field",decorators:[(0,U.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,U.MZ)({attribute:!1})],key:"time",value:void 0},{kind:"field",decorators:[(0,U.MZ)({attribute:!1})],key:"entityIds",value:void 0},{kind:"field",decorators:[(0,U.MZ)({attribute:!1})],key:"deviceIds",value:void 0},{kind:"field",decorators:[(0,U.MZ)({type:Boolean})],key:"narrow",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean,reflect:!0})],key:"virtualize",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean,attribute:"no-icon"})],key:"noIcon",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean,attribute:"no-name"})],key:"noName",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean,attribute:"show-indicator"})],key:"showIndicator",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean,attribute:"relative-time"})],key:"relativeTime",value:function(){return!1}},{kind:"field",decorators:[(0,U.MZ)({type:Boolean})],key:"showMoreLink",value:function(){return!0}},{kind:"field",decorators:[(0,U.wk)()],key:"_logbookEntries",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_traceContexts",value:function(){return{}}},{kind:"field",decorators:[(0,U.wk)()],key:"_userIdToName",value:function(){return{}}},{kind:"field",decorators:[(0,U.wk)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"field",key:"_liveUpdatesEnabled",value:function(){return!0}},{kind:"field",key:"_pendingStreamMessages",value:function(){return[]}},{kind:"field",key:"_throttleGetLogbookEntries",value:function(){var e=this;return(0,z.n)((function(){return e._getLogBookData()}),1e3)}},{kind:"method",key:"render",value:function(){return(0,Z.x)(this.hass,"logbook")?this._error?(0,C.qy)(G||(G=(0,c.A)(['<div class="no-entries"> '," </div>"])),"".concat(this.hass.localize("ui.components.logbook.retrieval_error"),": ").concat(this._error)):void 0===this._logbookEntries?(0,C.qy)(j||(j=(0,c.A)([' <div class="progress-wrapper"> <ha-circular-progress indeterminate></ha-circular-progress> </div> ']))):0===this._logbookEntries.length?(0,C.qy)(F||(F=(0,c.A)(['<div class="no-entries"> '," </div>"])),this.hass.localize("ui.components.logbook.entries_not_found")):(0,C.qy)(Q||(Q=(0,c.A)([' <ha-logbook-renderer .hass="','" .narrow="','" .virtualize="','" .noIcon="','" .noName="','" .showIndicator="','" .relativeTime="','" .entries="','" .traceContexts="','" .userIdToName="','" @hass-logbook-live="','"></ha-logbook-renderer> '])),this.hass,this.narrow,this.virtualize,this.noIcon,this.noName,this.showIndicator,this.relativeTime,this._logbookEntries,this._traceContexts,this._userIdToName,this._handleLogbookLive):C.s6}},{kind:"method",key:"refresh",value:(i=(0,u.A)((0,a.A)().mark((function e(){var t,n=arguments;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.length>0&&void 0!==n[0]&&n[0])||!this._subscribed&&void 0!==this._logbookEntries){e.next=3;break}return e.abrupt("return");case 3:this._throttleGetLogbookEntries.cancel(),this._updateTraceContexts.cancel(),this._updateUsers.cancel(),this._unsubscribeSetLoading(),t?this._getLogBookData():this._throttleGetLogbookEntries();case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"shouldUpdate",value:function(e){if(1!==e.size||!e.has("hass"))return!0;var t=e.get("hass");return!t||t.localize!==this.hass.localize}},{kind:"method",key:"willUpdate",value:function(e){for(var t=e.has("time"),n=0,i=["entityIds","deviceIds"];n<i.length;n++){var r=i[n];if(e.has(r)){var s=e.get(r),o=this[r];if(J(s,o)){t=!0;break}}}t&&this.refresh(!0)}},{kind:"method",key:"_handleLogbookLive",value:function(e){var t=this;e.detail.enable&&!this._liveUpdatesEnabled&&(this._pendingStreamMessages.forEach((function(e){return t._processStreamMessage(e)})),this._pendingStreamMessages=[]),this._liveUpdatesEnabled=e.detail.enable}},{kind:"get",key:"_filterAlwaysEmptyResults",value:function(){var e=this.entityIds,t=this.deviceIds;return Boolean(e||t)&&(!e||0===e.length)&&(!t||0===t.length)}},{kind:"method",key:"_unsubscribe",value:function(){this._subscribed&&(this._subscribed.then((function(e){return null==e?void 0:e()})),this._subscribed=void 0)}},{kind:"method",key:"connectedCallback",value:function(){(0,v.A)(r,"connectedCallback",this,3)([]),this.hasUpdated&&this._subscribeLogbookPeriod(this._calculateLogbookPeriod())}},{kind:"method",key:"disconnectedCallback",value:function(){(0,v.A)(r,"disconnectedCallback",this,3)([]),this._unsubscribeSetLoading()}},{kind:"method",key:"_unsubscribeSetLoading",value:function(){this._unsubscribe(),this._logbookEntries=void 0,this._pendingStreamMessages=[]}},{kind:"method",key:"_unsubscribeNoResults",value:function(){this._unsubscribe(),this._logbookEntries=[],this._pendingStreamMessages=[]}},{kind:"method",key:"_calculateLogbookPeriod",value:function(){var e=new Date;if("range"in this.time)return{now:e,startTime:this.time.range[0],endTime:this.time.range[1],purgeBeforePythonTime:void 0};if("recent"in this.time){var t=W(e,this.time.recent);return{now:e,startTime:new Date(1e3*t),endTime:new Date(e.getTime()+31536e6),purgeBeforePythonTime:W(e,this.time.recent)}}throw new Error("Unexpected time specified")}},{kind:"method",key:"_subscribeLogbookPeriod",value:function(e){var t=this;return this._subscribed||(this._subscribed=(0,D.gM)(this.hass,(function(e){t._subscribed&&t._processOrQueueStreamMessage(e)}),e.startTime.toISOString(),e.endTime.toISOString(),this.entityIds,this.deviceIds).catch((function(e){t._subscribed=void 0,t._error=e}))),!0}},{kind:"method",key:"_getLogBookData",value:(n=(0,u.A)((0,a.A)().mark((function e(){var t,n;return(0,a.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._error=void 0,!this._filterAlwaysEmptyResults){e.next=4;break}return this._unsubscribeNoResults(),e.abrupt("return");case 4:if(!((n=this._calculateLogbookPeriod()).startTime>n.now)){e.next=8;break}return this._unsubscribeNoResults(),e.abrupt("return");case 8:this._updateUsers(),null!==(t=this.hass.user)&&void 0!==t&&t.is_admin&&this._updateTraceContexts(),this._subscribeLogbookPeriod(n);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{kind:"field",key:"_nonExpiredRecords",value:function(){var e=this;return function(t){return e._logbookEntries?t?e._logbookEntries.filter((function(e){return e.when>t})):e._logbookEntries:[]}}},{kind:"field",key:"_processOrQueueStreamMessage",value:function(){var e=this;return function(t){e._liveUpdatesEnabled?e._processStreamMessage(t):e._pendingStreamMessages.push(t)}}},{kind:"field",key:"_processStreamMessage",value:function(){var e=this;return function(t){var n="recent"in e.time?W(new Date,e.time.recent):void 0,i=(0,o.A)(t.events).reverse();if(e._logbookEntries&&e._logbookEntries.length){if(i.length){var r=e._nonExpiredRecords(n);r.length?i[i.length-1].when>r[0].when?e._logbookEntries=i.concat(r):r[r.length-1].when>i[0].when?e._logbookEntries=r.concat(i):e._logbookEntries=r.concat(i).sort((function(e,t){return t.when-e.when})):e._logbookEntries=i}}else e._logbookEntries=i}}},{kind:"field",key:"_updateTraceContexts",value:function(){var e=this;return(0,z.n)((0,u.A)((0,a.A)().mark((function t(){return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,P.gq)(e.hass);case 2:e._traceContexts=t.sent;case 3:case"end":return t.stop()}}),t)}))),6e4)}},{kind:"field",key:"_updateUsers",value:function(){var e=this;return(0,z.n)((0,u.A)((0,a.A)().mark((function t(){var n,i,r,o,u,c,d,l,h,k;return(0,a.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i={},r=(null===(n=e.hass.user)||void 0===n?void 0:n.is_admin)&&(0,R.hU)(e.hass),o=0,u=Object.values(e.hass.states);o<u.length;o++)(c=u[o]).attributes.user_id&&"person"===(0,N.t)(c)&&(i[c.attributes.user_id]=c.attributes.friendly_name);if(!r){t.next=9;break}return t.next=6,r;case 6:d=t.sent,l=(0,s.A)(d);try{for(l.s();!(h=l.n()).done;)(k=h.value).id in i||(i[k.id]=k.name)}catch(a){l.e(a)}finally{l.f()}case 9:e._userIdToName=i;case 10:case"end":return t.stop()}}),t)}))),6e4)}},{kind:"get",static:!0,key:"styles",value:function(){return[(0,C.AH)(H||(H=(0,c.A)([":host{display:block}:host([virtualize]){height:100%}.no-entries{text-align:center;padding:16px;color:var(--secondary-text-color)}.progress-wrapper{display:flex;justify-content:center;height:100%;align-items:center}"])))]}}]}}),C.WF),i(),e.next=73;break;case 70:e.prev=70,e.t2=e.catch(0),i(e.t2);case 73:case"end":return e.stop()}}),e,null,[[0,70]])})));return function(t,n){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=88316.-LBgxuS0xL8.js.map