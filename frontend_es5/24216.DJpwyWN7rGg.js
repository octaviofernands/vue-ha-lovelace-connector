"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[24216],{23469:function(t,e,r){r.d(e,{g:function(){return o}});r(79641);var a=r(45253),n=r(92164);function o(t,e,r,o,i,s){var c=t.getPropertyValue(i+"-"+s).trim(),u=c.length>0?c:t.getPropertyValue(i).trim(),d=(0,a.RQ)(u);return 0===c.length&&s&&(d=(0,a.v2)((0,a.BE)(e?(0,n.T)((0,a.Nc)((0,a.xp)(d)),s):(0,n.d)((0,a.Nc)((0,a.xp)(d)),s)))),o?d+=r?"32":"7F":r&&(d+="7F"),d}},37334:function(t,e,r){var a=r(22858).A,n=r(33994).A;r.a(t,function(){var t=a(n().mark((function t(a,o){var i,s,c,u,d,l,f,h,g,v,_,y,p;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,p=function(t,e,r,a,n,o,i){var s=(0,u.c)(e,t),c=void 0!==o&&void 0!==i;if(c&&s<=35){var v=(0,d.M)(e,t),_=(0,d.M)(i,o);_>v?e=(0,l.L)(e,_-v):v>_&&(i=(0,l.L)(i,v-_))}var p={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:y(s,e),adapters:{date:{locale:r,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(t){return t.tick&&t.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:s>35?"monthyear":s>7?"date":s>2?"weekday":s>0?"datetime":"hour",minUnit:s>35?"month":s>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:n},ticks:{beginAtZero:!0,callback:function(t){return(0,f.ZV)(Math.abs(t),r)}}}},plugins:{tooltip:{position:"nearest",filter:function(t){return"0"!==t.formattedValue},itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:function(t){if(s>0)return t[0].label;var e=new Date(t[0].parsed.x);return"".concat(c?"".concat((0,h.sl)(e,r,a),": "):"").concat((0,g.fU)(e,r,a)," â€“ ").concat((0,g.fU)((0,l.L)(e,1),r,a))},label:function(t){return"".concat(t.dataset.label,": ").concat((0,f.ZV)(t.parsed.y,r)," ").concat(n)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,f.Yf)(r)};return c&&(p.scales.xAxisCompare=Object.assign(Object.assign({},p.scales.x),{},{suggestedMin:o.getTime(),max:y(s,i),display:!1})),p},y=function(t,e){var r=new Date(e);return t>2&&0===r.getHours()&&(r=(0,c.O)(r,1)),r.setMinutes(0,0,0),t>35&&r.setDate(1),t>2&&r.setHours(0),r.getTime()},r.d(e,{o:function(){return p}}),i=r(81027),s=r(26098),c=r(65513),u=r(31195),d=r(6711),l=r(83324),f=r(57636),h=r(57289),g=r(41924),!(v=a([f,h,g])).then){t.next=23;break}return t.next=19,v;case 19:t.t1=t.sent,t.t0=(0,t.t1)(),t.next=24;break;case 23:t.t0=v;case 24:_=t.t0,f=_[0],h=_[1],g=_[2],o(),t.next=34;break;case 31:t.prev=31,t.t2=t.catch(0),o(t.t2);case 34:case"end":return t.stop()}}),t,null,[[0,31]])})));return function(e,r){return t.apply(this,arguments)}}())},72069:function(t,e,r){var a=r(22858).A,n=r(33994).A;r.a(t,function(){var t=a(n().mark((function t(a,o){var i,s,c,u,d,l,f,h,g,v,_,y,p,b,m,k,x,A,w,O,j,D,M,S,E,z,C,I,F,V,H,N,P,R,T,Z,U,q,L,W,Y,B,G,Q,$,J,K,X,tt,et,rt,at,nt,ot,it,st,ct,ut,dt,lt,ft;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r.r(e),r.d(e,{HuiEnergyUsageGraphCard:function(){return ft}}),i=r(658),s=r(33994),c=r(41981),u=r(22858),d=r(64782),l=r(64599),f=r(35806),h=r(71008),g=r(62193),v=r(2816),_=r(27927),y=r(81027),p=r(13025),b=r(52427),m=r(82386),k=r(95737),x=r(89655),A=r(33231),w=r(29193),O=r(26098),j=r(99471),D=r(10507),M=r(39790),S=r(9241),E=r(74268),z=r(24545),C=r(51855),I=r(82130),F=r(31743),V=r(22328),H=r(4959),N=r(62435),P=r(99019),R=r(253),T=r(2075),Z=r(54846),U=r(4525),q=r(66555),L=r(96858),W=r(79784),Y=r(75697),B=r(5343),G=r(50289),Q=r(29818),$=r(85323),J=r(94100),K=r(23469),X=r(57636),r(90701),r(13082),tt=r(47076),et=r(4826),rt=r(20712),at=r(7934),nt=r(37334),!(ot=a([X,tt,nt])).then){t.next=94;break}return t.next=90,ot;case 90:t.t1=t.sent,t.t0=(0,t.t1)(),t.next=95;break;case 94:t.t0=ot;case 95:it=t.t0,X=it[0],tt=it[1],nt=it[2],lt={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},ft=(0,_.A)([(0,Q.EM)("hui-energy-usage-graph-card")],(function(t,e){var r,a=function(e){function r(){var e;(0,h.A)(this,r);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return e=(0,g.A)(this,r,[].concat(n)),t(e),e}return(0,v.A)(r,e),(0,f.A)(r)}(e);return{F:a,d:[{kind:"field",decorators:[(0,Q.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,Q.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,Q.wk)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,Q.wk)()],key:"_start",value:function(){return(0,W.R)()}},{kind:"field",decorators:[(0,Q.wk)()],key:"_end",value:function(){return(0,Y.o)()}},{kind:"field",decorators:[(0,Q.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,Q.wk)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var t,e=this;return[(0,tt.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((function(t){return e._getStatistics(t)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,at.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,G.qy)(st||(st=(0,l.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,G.qy)(ct||(ct=(0,l.A)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,$.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(t){return t.data.length}))?"":(0,G.qy)(ut||(ut=(0,l.A)(['<div class="no-data"> '," </div>"])),(0,B.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):G.s6}},{kind:"field",key:"_createOptions",value:function(){var t=this;return(0,J.A)((function(e,r,a,n,o,i){var s=(0,nt.o)(e,r,a,n,"kWh",o,i),c=Object.assign(Object.assign({},s),{},{plugins:Object.assign(Object.assign({},s.plugins),{},{tooltip:Object.assign(Object.assign({},s.plugins.tooltip),{},{itemSort:function(t,e){var r,a,n,o,i;return(null===(r=t.raw)||void 0===r?void 0:r.y)>0&&(null===(a=e.raw)||void 0===a?void 0:a.y)<0?-1:(null===(n=e.raw)||void 0===n?void 0:n.y)>0&&(null===(o=t.raw)||void 0===o?void 0:o.y)<0?1:(null===(i=t.raw)||void 0===i?void 0:i.y)>0?e.datasetIndex-t.datasetIndex:t.datasetIndex-e.datasetIndex},callbacks:Object.assign(Object.assign({},s.plugins.tooltip.callbacks),{},{footer:function(e){var r,n=0,o=0,i=(0,d.A)(e);try{for(i.s();!(r=i.n()).done;){var s=r.value,c=s.dataset.data[s.dataIndex].y;c>0?n+=c:o+=Math.abs(c)}}catch(u){i.e(u)}finally{i.f()}return[n?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,X.ZV)(n,a)}):"",o?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,X.ZV)(o,a)}):""].filter(Boolean)}})})})});return c}))}},{kind:"method",key:"_getStatistics",value:(r=(0,u.A)((0,s.A)().mark((function t(e){var r,a,n,o,i,u,l,f,h,g,v,_,y,p;return(0,s.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],a={},n=(0,d.A)(e.prefs.energy_sources),t.prev=3,n.s();case 5:if((o=n.n()).done){t.next=21;break}if("solar"!==(i=o.value).type){t.next=10;break}return a.solar?a.solar.push(i.stat_energy_from):a.solar=[i.stat_energy_from],t.abrupt("continue",19);case 10:if("battery"!==i.type){t.next=13;break}return a.to_battery?(a.to_battery.push(i.stat_energy_to),a.from_battery.push(i.stat_energy_from)):(a.to_battery=[i.stat_energy_to],a.from_battery=[i.stat_energy_from]),t.abrupt("continue",19);case 13:if("grid"===i.type){t.next=15;break}return t.abrupt("continue",19);case 15:u=(0,d.A)(i.flow_from);try{for(u.s();!(l=u.n()).done;)f=l.value,a.from_grid?a.from_grid.push(f.stat_energy_from):a.from_grid=[f.stat_energy_from]}catch(s){u.e(s)}finally{u.f()}h=(0,d.A)(i.flow_to);try{for(h.s();!(g=h.n()).done;)v=g.value,a.to_grid?a.to_grid.push(v.stat_energy_to):a.to_grid=[v.stat_energy_to]}catch(s){h.e(s)}finally{h.f()}case 19:t.next=5;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(3),n.e(t.t0);case 26:return t.prev=26,n.f(),t.finish(26);case 29:_=getComputedStyle(this),y={},Object.keys(lt).forEach((function(t){y[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&a[t]&&Object.values(a[t]).forEach((function(e,r){y[t][e]=r}))})),p={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=e.start,this._end=e.end||(0,Y.o)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,r.push.apply(r,(0,c.A)(this._processDataSet(e.stats,e.statsMetadata,a,y,_,p,!1))),e.statsCompare&&(r.push({order:0,data:[]}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push.apply(r,(0,c.A)(this._processDataSet(e.statsCompare,e.statsMetadata,a,y,_,p,!0)))),this._chartData={datasets:r};case 40:case"end":return t.stop()}}),t,this,[[3,23,26,29]])}))),function(t){return r.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(t,e,r,a,n,o){var s,c=this,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=[],f={},h={};Object.entries(r).forEach((function(e){var r=(0,i.A)(e,2),a=r[0],n=r[1],o=["solar","to_grid","from_grid","to_battery","from_battery"].includes(a),c=!["solar","from_battery"].includes(a),u={},d={};n.forEach((function(e){var r=t[e];if(r){var a={};r.forEach((function(t){if(null!==t.change&&void 0!==t.change){var e=t.change;o&&(u[t.start]=t.start in u?u[t.start]+e:e,s=t.end),c&&!(t.start in a)&&(a[t.start]=e,s=t.end)}})),d[e]=a}})),o&&(h[a]=u),c&&(f[a]=d)}));var g={},v={};if((h.to_grid||h.to_battery)&&h.solar){for(var _={},y=0,p=Object.keys(h.solar);y<p.length;y++){var b,m,k=p[y];if(_[k]=(h.solar[k]||0)-((null===(b=h.to_grid)||void 0===b?void 0:b[k])||0)-((null===(m=h.to_battery)||void 0===m?void 0:m[k])||0),_[k]<0){var x,A,w;if(h.to_battery)if(g[k]=-1*_[k],g[k]>((null===(x=h.from_grid)||void 0===x?void 0:x[k])||0))v[k]=g[k]-((null===(A=h.from_grid)||void 0===A?void 0:A[k])||0),g[k]=null===(w=h.from_grid)||void 0===w?void 0:w[k];_[k]=0}}f.used_solar={used_solar:_}}if(h.from_battery)if(h.to_grid){for(var O={},j=0,D=Object.keys(h.from_battery);j<D.length;j++){var M=D[j];O[M]=(h.from_battery[M]||0)-(v[M]||0)}f.used_battery={used_battery:O}}else f.used_battery={used_battery:h.from_battery};if(f.from_grid&&h.to_battery){for(var S={},E=function(){for(var t,e=C[z],r=0,a=0,n=Object.entries(f.from_grid);a<n.length;a++){var o=(0,i.A)(n[a],2),s=o[0];if(o[1][e]&&(t=s,r++),r>1)break}if(1===r)f.from_grid[t][e]-=g[e]||0;else{var c=0;Object.values(f.from_grid).forEach((function(t){c+=t[e]||0,delete t[e]})),S[e]=c-(g[e]||0)}},z=0,C=Object.keys(g);z<C.length;z++)E();f.used_grid={used_grid:S}}var I=[];Object.values(f).forEach((function(t){Object.values(t).forEach((function(t){I=I.concat(Object.keys(t))}))}));var F=Array.from(new Set(I)).sort((function(t,e){return Number(t)-Number(e)}));return Object.entries(f).forEach((function(t){var r=(0,i.A)(t,2),h=r[0],g=r[1];Object.entries(g).forEach((function(t,r){var g,v,_,y=(0,i.A)(t,2),p=y[0],b=y[1],m=[],k=(0,d.A)(F);try{for(k.s();!(_=k.n()).done;){var x=_.value,A=b[x]||0;m.push({x:Number(x),y:A&&["to_grid","to_battery"].includes(h)?-1*A:A})}}catch(w){k.e(w)}finally{k.f()}1===m.length&&m.push({x:s,y:0}),l.push({label:h in o?o[h]:(0,et.$O)(c.hass,p,e[p]),order:"used_solar"===h?1:"to_battery"===h?Object.keys(f).length:r+2,borderColor:(0,K.g)(n,c.hass.themes.darkMode,!1,u,lt[h],null===(g=a[h])||void 0===g?void 0:g[p]),backgroundColor:(0,K.g)(n,c.hass.themes.darkMode,!0,u,lt[h],null===(v=a[h])||void 0===v?void 0:v[p]),stack:"stack",data:m,xAxisID:u?"xAxisCompare":void 0})}))})),l}},{kind:"get",static:!0,key:"styles",value:function(){return(0,G.AH)(dt||(dt=(0,l.A)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"])))}}]}}),(0,rt.E)(G.WF)),o(),t.next=107;break;case 104:t.prev=104,t.t2=t.catch(0),o(t.t2);case 107:case"end":return t.stop()}}),t,null,[[0,104]])})));return function(e,r){return t.apply(this,arguments)}}())},24226:function(t,e,r){r.d(e,{z:function(){return n}});var a=r(30429);function n(t,e){var r=(0,a.a)(t),n=(0,a.a)(e),o=r.getTime()-n.getTime();return o<0?-1:o>0?1:o}},72730:function(t,e,r){r.d(e,{W:function(){return s}});r(29193);var a=r(24226),n=r(30429);function o(t,e){var r=(0,n.a)(t),a=(0,n.a)(e);return 12*(r.getFullYear()-a.getFullYear())+(r.getMonth()-a.getMonth())}var i=r(91103);function s(t,e){var r,s=(0,n.a)(t),c=(0,n.a)(e),u=(0,a.z)(s,c),d=Math.abs(o(s,c));if(d<1)r=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-u*d);var l=(0,a.z)(s,c)===-u;(0,i.c)((0,n.a)(t))&&1===d&&1===(0,a.z)(t,c)&&(l=!1),r=u*(d-Number(l))}return 0===r?0:r}},75697:function(t,e,r){r.d(e,{o:function(){return n}});var a=r(60132);function n(){return(0,a.D)(Date.now())}},77301:function(t,e,r){r.d(e,{e:function(){return n}});var a=r(30429);function n(t){return 1===(0,a.a)(t).getDate()}},91103:function(t,e,r){r.d(e,{c:function(){return i}});var a=r(60132),n=r(12152),o=r(30429);function i(t){var e=(0,o.a)(t);return+(0,a.D)(e)==+(0,n.p)(e)}},5343:function(t,e,r){r.d(e,{c:function(){return i}});var a=r(59613);function n(t){return(0,a.w)(t,Date.now())}var o=r(9854);function i(t){return(0,o.r)(t,n(t))}},65513:function(t,e,r){r.d(e,{O:function(){return n}});var a=r(83324);function n(t,e){return(0,a.L)(t,-e)}}}]);
//# sourceMappingURL=24216.DJpwyWN7rGg.js.map