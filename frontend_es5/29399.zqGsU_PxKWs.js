"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[29399],{46999:function(t,e,i){i.d(e,{Vy:function(){return r},fI:function(){return s}});var n=i(45253),o=["#44739e","#984ea3","#00d2d5","#ff7f00","#af8d00","#7f80cd","#b3e900","#c42e60","#a65628","#f781bf","#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#fccde5","#bc80bd","#ffed6f","#c4eaff","#cf8c00","#1b9e77","#d95f02","#e7298a","#e6ab02","#a6761d","#0097ff","#00d067","#f43600","#4ba93b","#5779bb","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function r(t){return o[t%o.length]}function s(t,e){var i=e.getPropertyValue("--graph-color-".concat(t+1))||r(t);return(0,n.RQ)(i)}},77226:function(t,e,i){i.d(e,{A:function(){return o}});i(71499),i(28552),i(36016),i(55228),i(43037);var n=function(t){var e=parseFloat(t);if(isNaN(e))throw new Error("".concat(t," is not a number"));return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:n(t.substr(0,t.length-1))};var e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:n(e[0]),h:1}:{w:n(e[0]),h:n(e[1])}}catch(i){}return null}},29399:function(t,e,i){var n=i(22858).A,o=i(33994).A;i.a(t,function(){var t=n(o().mark((function t(n,r){var s,a,c,u,d,h,l,f,_,v,g,b,k,m,y,p,w,A,E,H,x,M,C,V,P,z,O,F,S,D,U,I,Z,B,L,N,R,T,W,j,q,Q,Y,G,J,K,X,$,tt,et,it,nt;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:function(){return it},DEFAULT_ZOOM:function(){return nt}}),s=i(64782),a=i(41981),c=i(64599),u=i(33994),d=i(22858),h=i(35806),l=i(71008),f=i(62193),_=i(2816),v=i(27927),g=i(35890),b=i(71499),k=i(81027),m=i(44124),y=i(82386),p=i(95737),w=i(97741),A=i(89655),E=i(50693),H=i(29193),x=i(82115),M=i(10507),C=i(39790),V=i(9241),P=i(66457),z=i(36604),O=i(99019),F=i(253),S=i(94438),D=i(16891),U=i(96858),I=i(50289),Z=i(29818),B=i(94100),L=i(46999),N=i(33922),R=i(213),T=i(19244),W=i(16569),j=i(77226),i(13082),i(13292),i(4169),q=i(4712),Q=i(11630),Y=i(7934),G=i(18102),J=i(62241),!(K=n([q,Q])).then){t.next=79;break}return t.next=75,K;case 75:t.t1=t.sent,t.t0=(0,t.t1)(),t.next=80;break;case 79:t.t0=K;case 80:X=t.t0,q=X[0],Q=X[1],it=0,nt=14,(0,v.A)([(0,Z.EM)("hui-map-card")],(function(t,e){var n,o=function(e){function i(){var e;(0,l.A)(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e=(0,f.A)(this,i,[].concat(o)),t(e),e}return(0,_.A)(i,e),(0,h.A)(i)}(e);return{F:o,d:[{kind:"field",decorators:[(0,Z.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,Z.MZ)({attribute:!1})],key:"layout",value:void 0},{kind:"field",decorators:[(0,Z.wk)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,Z.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,Z.P)("ha-map")],key:"_map",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",decorators:[(0,Z.wk)()],key:"_mapEntities",value:function(){return[]}},{kind:"field",key:"_colorDict",value:function(){return{}}},{kind:"field",key:"_colorIndex",value:function(){return 0}},{kind:"field",decorators:[(0,Z.wk)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"setConfig",value:function(t){var e;if(!t)throw new Error("Error in card configuration.");if(!(null!==(e=t.entities)&&void 0!==e&&e.length||t.geo_location_sources))throw new Error("Either entities or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");this._config=t,this._configEntities=t.entities?(0,J.L)(t.entities):[],this._mapEntities=this._getMapEntities()}},{kind:"method",key:"getCardSize",value:function(){var t;if(null===(t=this._config)||void 0===t||!t.aspect_ratio)return 7;var e=(0,j.A)(this._config.aspect_ratio),i=e&&e.w>0&&e.h>0?"".concat((100*e.h/e.w).toFixed(2)):"100";return 1+Math.floor(Number(i)/25)||3}},{kind:"method",static:!0,key:"getConfigElement",value:(n=(0,d.A)((0,u.A)().mark((function t(){return(0,u.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.e(82730),i.e(57396)]).then(i.bind(i,57396));case 2:return t.abrupt("return",document.createElement("hui-map-card-editor"));case 3:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"map",entities:(0,G.B)(t,2,e,i,["device_tracker"]),theme_mode:"auto"}}},{kind:"method",key:"render",value:function(){var t;if(!this._config)return I.s6;if(this._error)return(0,I.qy)($||($=(0,c.A)(['<ha-alert alert-type="error"> ',": "," (",") </ha-alert>"])),this.hass.localize("ui.components.map.error"),this._error.message,this._error.code);var e=!(!this._config.dark_mode&&"dark"!==this._config.theme_mode)||"light"!==this._config.theme_mode&&this.hass.themes.darkMode,i=this._config.theme_mode||(this._config.dark_mode?"dark":"auto");return(0,I.qy)(tt||(tt=(0,c.A)([' <ha-card id="card" .header="','"> <div id="root"> <ha-map .hass="','" .entities="','" .zoom="','" .paths="','" .autoFit="','" .fitZones="','" .themeMode="','" interactiveZones renderPassive></ha-map> <ha-icon-button .label="','" .path="','" style="','" @click="','" tabindex="0"></ha-icon-button> </div> </ha-card> '])),this._config.title,this.hass,this._mapEntities,null!==(t=this._config.default_zoom)&&void 0!==t?t:nt,this._getHistoryPaths(this._config,this._stateHistory),this._config.auto_fit||!1,this._config.fit_zones,i,this.hass.localize("ui.panel.lovelace.cards.map.reset_focus"),"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",e?"color:#ffffff":"color:#000000",this._fitMap)}},{kind:"method",key:"shouldUpdate",value:function(t){var e,i;if(!t.has("hass")||t.size>1)return!0;var n=t.get("hass");return!n||!this._configEntities||(n.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(null===(e=this._config)||void 0===e||!e.geo_location_sources||n.states===this.hass.states)||(null!==(i=this._config)&&void 0!==i&&i.entities?(0,Y.pY)(this,t):(0,Y.xP)(this,t)))))}},{kind:"method",key:"willUpdate",value:function(t){var e,i;(0,g.A)(o,"willUpdate",this,3)([t]),t.has("hass")&&null!==(e=this._config)&&void 0!==e&&e.geo_location_sources&&!(0,W.b)(this._getSourceEntities(null===(i=t.get("hass"))||void 0===i?void 0:i.states),this._getSourceEntities(this.hass.states))&&(this._mapEntities=this._getMapEntities())}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,g.A)(o,"connectedCallback",this,3)([]),this.hasUpdated&&null!==(t=this._configEntities)&&void 0!==t&&t.length&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,g.A)(o,"disconnectedCallback",this,3)([]),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){var t,e,i,n=this;(0,N.x)(this.hass,"history")&&!this._subscribed&&(null!==(t=null===(e=this._config)||void 0===e?void 0:e.hours_to_show)&&void 0!==t?t:it)&&(this._subscribed=(0,Q.IQ)(this.hass,(function(t){n._subscribed&&(n._stateHistory=t)}),null!==(i=this._config.hours_to_show)&&void 0!==i?i:it,(this._configEntities||[]).map((function(t){return t.entity})),!1,!1,!1).catch((function(t){n._subscribed=void 0,n._error=t})))}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._subscribed&&(this._subscribed.then((function(t){return null==t?void 0:t()})),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){var e;null!==(e=this._configEntities)&&void 0!==e&&e.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}},{kind:"method",key:"_computePadding",value:function(){var t=this.shadowRoot.getElementById("root"),e="panel"===this.layout||"grid"===this.layout;if(this._config&&!e&&t)if(this._config.aspect_ratio){t.style.height="auto";var i=(0,j.A)(this._config.aspect_ratio);t.style.paddingBottom=i&&i.w>0&&i.h>0?"".concat((100*i.h/i.w).toFixed(2),"%"):t.style.paddingBottom="100%"}else t.style.paddingBottom="100%"}},{kind:"method",key:"_fitMap",value:function(){var t;null===(t=this._map)||void 0===t||t.fitMap()}},{kind:"method",key:"_getColor",value:function(t){var e=this._colorDict[t];return e||(e=(0,L.Vy)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}},{kind:"method",key:"_getSourceEntities",value:function(t){var e;if(!t||null===(e=this._config)||void 0===e||!e.geo_location_sources)return[];for(var i=[],n=this._config.geo_location_sources.includes("all"),o=0,r=Object.values(t);o<r.length;o++){var s=r[o];"geo_location"===(0,R.m)(s.entity_id)&&(n||this._config.geo_location_sources.includes(s.attributes.source))&&i.push(s.entity_id)}return i}},{kind:"method",key:"_getMapEntities",value:function(){var t,e=this;return[].concat((0,a.A)((this._configEntities||[]).map((function(t){return{entity_id:t.entity,color:e._getColor(t.entity),label_mode:t.label_mode,focus:t.focus,name:t.name}}))),(0,a.A)(this._getSourceEntities(null===(t=this.hass)||void 0===t?void 0:t.states).map((function(t){return{entity_id:t,color:e._getColor(t)}}))))}},{kind:"field",key:"_getHistoryPaths",value:function(){var t=this;return(0,B.A)((function(e,i){var n;if(i&&(null!==(n=e.hours_to_show)&&void 0!==n?n:it)){for(var o=[],r=function(){var n,r,u,d=c[a];if("zone"===(0,R.m)(d))return 0;var h=i[d];if(null==h||!h.length)return 0;var l,f=[],_=(0,s.A)(h);try{for(_.s();!(l=_.n()).done;){var v=l.value,g=v.a.latitude,b=v.a.longitude;if(g&&b){var k={};k.point=[g,b],k.timestamp=new Date(1e3*v.lu),f.push(k)}}}catch(p){_.e(p)}finally{_.f()}var m=null===(n=t._configEntities)||void 0===n?void 0:n.find((function(t){return t.entity===d})),y=null!==(r=null==m?void 0:m.name)&&void 0!==r?r:d in t.hass.states?(0,T.u)(t.hass.states[d]):d;o.push({points:f,name:y,fullDatetime:(null!==(u=e.hours_to_show)&&void 0!==u?u:it)>144,color:t._getColor(d),gradualOpacity:.8})},a=0,c=Object.keys(i);a<c.length;a++)r();return o}}))}},{kind:"method",key:"getLayoutOptions",value:function(){return{grid_columns:"full",grid_rows:4,grid_min_columns:2,grid_min_rows:2}}},{kind:"get",static:!0,key:"styles",value:function(){return(0,I.AH)(et||(et=(0,c.A)(["ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit}ha-icon-button{position:absolute;top:75px;left:3px;outline:0}#root{position:relative;height:100%}"])))}}]}}),I.WF),r(),t.next=93;break;case 90:t.prev=90,t.t2=t.catch(0),r(t.t2);case 93:case"end":return t.stop()}}),t,null,[[0,90]])})));return function(e,i){return t.apply(this,arguments)}}())}}]);
//# sourceMappingURL=29399.zqGsU_PxKWs.js.map