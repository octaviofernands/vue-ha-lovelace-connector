export const id=21628;export const ids=[21628];export const modules={77226:(t,e,i)=>{i.d(e,{A:()=>s});const a=t=>{const e=parseFloat(t);if(isNaN(e))throw new Error(`${t} is not a number`);return e};function s(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:a(t.substr(0,t.length-1))};const e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:a(e[0]),h:1}:{w:a(e[0]),h:a(e[1])}}catch(t){}return null}},9755:(t,e,i)=>{i.d(e,{e:()=>a});const a=t=>`/api/image_proxy/${t.entity_id}?token=${t.attributes.access_token}&state=${t.state}`},21628:(t,e,i)=>{i.r(e);var a=i(36312),s=i(68689),o=(i(89655),i(24545),i(51855),i(82130),i(31743),i(22328),i(4959),i(62435),i(253),i(54846),i(16891),i(50289)),n=i(29818),r=i(85323),h=i(10977),d=i(94872),c=i(38962),l=i(213),g=i(19244),m=(i(13082),i(4169),i(70857),i(9755)),u=i(25319),_=i(18102),f=i(63582),v=i(562),k=i(7934),p=i(62241),y=(i(16204),i(46645));i(37940);const b=new Set(["closed","locked","not_home","off"]);(0,a.A)([(0,n.EM)("hui-picture-glance-card")],(function(t,e){class a extends e{constructor(...e){super(...e),t(this)}}return{F:a,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await i.e(73707).then(i.bind(i,73707)),document.createElement("hui-picture-glance-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"picture-glance",title:"Kitchen",image:"https://demo.home-assistant.io/stub_config/kitchen.png",entities:(0,_.B)(t,2,e,i,["sensor","binary_sensor"])}}},{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_config",value:void 0},{kind:"field",key:"_entitiesDialog",value:void 0},{kind:"field",key:"_entitiesToggle",value:void 0},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){if(!t||!t.entities||!Array.isArray(t.entities)||!(t.image||t.image_entity||t.camera_image||t.state_image)||t.state_image&&!t.entity)throw new Error("Invalid configuration");const e=(0,p.L)(t.entities);this._entitiesDialog=[],this._entitiesToggle=[],e.forEach((e=>{t.force_dialog||!d.FD.has((0,l.m)(e.entity))?this._entitiesDialog.push(e):this._entitiesToggle.push(e)})),this._config={hold_action:{action:"more-info"},...t}}},{kind:"method",key:"shouldUpdate",value:function(t){if(!this._config||(0,k.LX)(this,t))return!0;if(!t.has("hass"))return!1;const e=t.get("hass");if(!e||e.themes!==this.hass.themes||e.locale!==this.hass.locale)return!0;if(this._config.image_entity&&e.states[this._config.image_entity]!==this.hass.states[this._config.image_entity])return!0;if(this._entitiesDialog)for(const t of this._entitiesDialog)if(e.states[t.entity]!==this.hass.states[t.entity])return!0;if(this._entitiesToggle)for(const t of this._entitiesToggle)if(e.states[t.entity]!==this.hass.states[t.entity])return!0;return!1}},{kind:"method",key:"updated",value:function(t){if((0,s.A)(a,"updated",this,3)([t]),!this._config||!this.hass)return;const e=t.get("hass"),i=t.get("_config");e&&i&&e.themes===this.hass.themes&&i.theme===this._config.theme||(0,c.Q)(this,this.hass.themes,this._config.theme)}},{kind:"method",key:"render",value:function(){if(!this._config||!this.hass)return o.s6;let t=this._config.image;if(this._config.image_entity){const e=this.hass.states[this._config.image_entity];switch((0,l.m)(this._config.image_entity)){case"image":t=(0,m.e)(e);break;case"person":e.attributes.entity_picture&&(t=e.attributes.entity_picture)}}return o.qy` <ha-card> <hui-image class="${(0,r.H)({clickable:Boolean(this._config.tap_action||this._config.hold_action||this._config.camera_image||this._config.image_entity)})}" @action="${this._handleAction}" .actionHandler="${(0,u.T)({hasHold:(0,v.h)(this._config.hold_action),hasDoubleClick:(0,v.h)(this._config.double_tap_action)})}" tabindex="${(0,h.J)((0,v.h)(this._config.tap_action)?"0":void 0)}" .config="${this._config}" .hass="${this.hass}" .image="${t}" .stateImage="${this._config.state_image}" .stateFilter="${this._config.state_filter}" .cameraImage="${this._config.camera_image}" .cameraView="${this._config.camera_view}" .entity="${this._config.entity}" .aspectRatio="${this._config.aspect_ratio}"></hui-image> <div class="box"> ${this._config.title?o.qy`<div class="title">${this._config.title}</div>`:""} <div class="row"> ${this._entitiesDialog.map((t=>this.renderEntity(t,!0)))} </div> <div class="row"> ${this._entitiesToggle.map((t=>this.renderEntity(t,!1)))} </div> </div> </ha-card> `}},{kind:"method",key:"renderEntity",value:function(t,e){const i=this.hass.states[t.entity];return t={tap_action:{action:e?"more-info":"toggle"},hold_action:{action:"more-info"},...t},i?o.qy` <div class="wrapper"> <ha-icon-button @action="${this._handleAction}" .actionHandler="${(0,u.T)({hasHold:(0,v.h)(t.hold_action),hasDoubleClick:(0,v.h)(t.double_tap_action)})}" tabindex="${(0,h.J)((0,v.h)(t.tap_action)?void 0:"-1")}" .disabled="${!(0,v.h)(t.tap_action)}" .config="${t}" class="${(0,r.H)({"state-on":!b.has(i.state)})}" title="${`${(0,g.u)(i)} : ${this.hass.formatEntityState(i)}`}"> <ha-state-icon .icon="${t.icon}" .stateObj="${i}" .hass="${this.hass}"></ha-state-icon> </ha-icon-button> ${!0!==this._config.show_state&&!0!==t.show_state?o.qy`<div class="state"></div>`:o.qy` <div class="state"> ${t.attribute?o.qy` ${t.prefix}${i.attributes[t.attribute]}${t.suffix} `:this.hass.formatEntityState(i)} </div> `} </div> `:o.qy` <hui-warning-element .label="${(0,y.j)(this.hass,t.entity)}"></hui-warning-element> `}},{kind:"method",key:"_handleAction",value:function(t){const e=t.currentTarget.config;(0,f.$)(this,this.hass,e,t.detail.action)}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`ha-card{position:relative;min-height:48px;overflow:hidden;height:100%;box-sizing:border-box}hui-image.clickable{cursor:pointer}.box{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:absolute;left:0;right:0;bottom:0;background-color:var(--ha-picture-card-background-color,rgba(0,0,0,.3));padding:4px 8px;font-size:16px;line-height:40px;color:var(--ha-picture-card-text-color,#fff);display:flex;justify-content:space-between;flex-direction:row}.box .title{font-weight:500;margin-left:8px;margin-inline-start:8px;margin-inline-end:initial}ha-icon-button{--mdc-icon-button-size:40px;--disabled-text-color:currentColor;color:var(--ha-picture-icon-button-color,#a9a9a9)}ha-icon-button.state-on{color:var(--ha-picture-icon-button-on-color,#fff)}hui-warning-element{padding:0 8px}.state{display:block;font-size:12px;text-align:center;line-height:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.row{display:flex;flex-direction:row}.wrapper{display:flex;flex-direction:column;width:40px}`}}]}}),o.WF)},16204:(t,e,i)=>{var a=i(36312),s=i(68689),o=(i(253),i(2075),i(50289)),n=i(29818),r=i(85323),h=i(55165),d=i(94872),c=i(213),l=i(77226),g=(i(6188),i(32885),i(88800)),m=i(9883),u=i(9755);var _=function(t){return t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Error=3]="Error",t}(_||{});(0,a.A)([(0,n.EM)("hui-image")],(function(t,e){class i extends e{constructor(...e){super(...e),t(this)}}return{F:i,d:[{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"image",value:void 0},{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,n.MZ)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_imageVisible",value:()=>!1},{kind:"field",decorators:[(0,n.wk)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:()=>null},{kind:"method",key:"connectedCallback",value:function(){(0,s.A)(i,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=_.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,s.A)(i,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(t){this._imageVisible=t[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(t){if(t.has("hass")){const e=t.get("hass");this._shouldStartCameraUpdates(e)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=_.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}t.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),t.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,l.A)(this.aspectRatio):null),this._loadState!==_.Loading||this.cameraImage||(this._loadState=_.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return o.s6;const t=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),e=this.entity?this.hass.states[this.entity]:void 0,i=e?e.state:m.Hh;let a,s,n=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?s=this.hass.states[this.cameraImage]:a=this._cameraImageSrc;else if(this.stateImage){const t=this.stateImage[i];t?a=t:(a=this.image,n=!0)}else a=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:e&&"image"===(0,c.m)(e.entity_id)?(0,u.e)(e):this.image;a&&(a=this.hass.hassUrl(a));let l=this.filter||"";if(this.hass.themes.darkMode&&this.darkModeFilter&&(l+=this.darkModeFilter),this.stateFilter&&this.stateFilter[i]&&(l+=this.stateFilter[i]),!l&&this.entity){l=(!e||d.jj.includes(i))&&n?"grayscale(100%)":""}return o.qy` <div style="${(0,h.W)({paddingBottom:t?`${(100*this._ratio.h/this._ratio.w).toFixed(2)}%`:void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:t&&this._loadedImageSrc?`url("${this._loadedImageSrc}")`:void 0,filter:this._loadState===_.Loaded||"live"===this.cameraView?l:void 0})}" class="container ${(0,r.H)({ratio:t||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode})}"> ${this.cameraImage&&"live"===this.cameraView?o.qy` <ha-camera-stream muted .hass="${this.hass}" .stateObj="${s}" @load="${this._onVideoLoad}"></ha-camera-stream> `:void 0===a?o.s6:o.qy` <img id="image" src="${a}" @error="${this._onImageError}" @load="${this._onImageLoad}" style="${(0,h.W)({display:t||this._loadState===_.Loaded?"block":"none"})}"> `} ${this._loadState===_.Error?o.qy`<div id="brokenImage" style="${(0,h.W)({height:t?void 0:`${this._lastImageHeight}px`||"100%"})}"></div>`:"live"===this.cameraView||void 0!==a&&this._loadState!==_.Loading?"":o.qy`<div class="progress-container" style="${(0,h.W)({height:t?void 0:`${this._lastImageHeight}px`||"100%"})}"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>`} </div> `}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(t){return!(t&&t.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((()=>this._updateCameraImageSrcAtInterval()),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=_.Error}},{kind:"method",key:"_onImageLoad",value:async function(t){this._loadState=_.Loaded;const e=t.target;this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=e.src),await this.updateComplete,this._lastImageHeight=e.offsetHeight}},{kind:"method",key:"_onVideoLoad",value:async function(t){this._loadState=_.Loaded;const e=t.currentTarget;await this.updateComplete,this._lastImageHeight=e.offsetHeight}},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:async function(){return this._loadState===_.Loading&&this._onImageError(),this._updateCameraImageSrc()}},{kind:"method",key:"_updateCameraImageSrc",value:async function(){if(!this.hass||!this.cameraImage)return;if(!this.hass.states[this.cameraImage])return void this._onImageError();const t=this.clientWidth||640;let e,i=Math.ceil(t*devicePixelRatio);this._lastImageHeight?e=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?e=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,e=Math.ceil(.5625*i)),this._cameraImageSrc=await(0,g.C4)(this.hass,this.cameraImage,i,e),void 0===this._cameraImageSrc&&this._onImageError()}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`:host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}`}}]}}),o.WF)}};
//# sourceMappingURL=21628.tas5OLuh-kc.js.map