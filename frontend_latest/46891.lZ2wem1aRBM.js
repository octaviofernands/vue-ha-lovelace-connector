export const id=46891;export const ids=[46891,64741];export const modules={64741:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{J:()=>f,computeStateDisplay:()=>_});var n=i(9883),r=i(45269),o=i(9449),a=i(57289),c=i(8581),u=i(41924),l=i(57636),d=i(40863),h=i(213),m=t([a,c,u,l]);[a,c,u,l]=m.then?(await m)():m;const _=(t,e,i,s,n,r,o)=>{const a=r?.[e.entity_id];return f(t,i,s,n,a,e.entity_id,e.attributes,void 0!==o?o:e.state)},f=(t,e,i,s,m,_,f,y)=>{if(y===n.HV||y===n.Hh)return t(`state.default.${y}`);const b=(0,h.m)(_);if((0,l.ty)(f,"sensor"===b?i:[])){if("duration"===f.device_class&&f.unit_of_measurement&&o.Z[f.unit_of_measurement])try{return(0,o.a)(y,f.unit_of_measurement)}catch(t){}if("monetary"===f.device_class)try{return(0,l.ZV)(y,e,{style:"currency",currency:f.unit_of_measurement,minimumFractionDigits:2,...(0,l.ZQ)({state:y,attributes:f},m)})}catch(t){}const t=(0,l.ZV)(y,e,(0,l.ZQ)({state:y,attributes:f},m)),i=f.unit_of_measurement;return i?`${t}${(0,d.A)(i,e)}${i}`:t}if("datetime"===b){const t=new Date(y);return(0,c.r6)(t,e,s)}if(["date","input_datetime","time"].includes(b))try{const t=y.split(" ");if(2===t.length)return(0,c.r6)(new Date(t.join("T")),{...e,time_zone:r.Wj.local},s);if(1===t.length){if(y.includes("-"))return(0,a.Yq)(new Date(`${y}T00:00`),{...e,time_zone:r.Wj.local},s);if(y.includes(":")){const t=new Date;return(0,u.fU)(new Date(`${t.toISOString().split("T")[0]}T${y}`),{...e,time_zone:r.Wj.local},s)}}return y}catch(t){return y}if("counter"===b||"number"===b||"input_number"===b)return(0,l.ZV)(y,e,(0,l.ZQ)({state:y,attributes:f},m));if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word"].includes(b)||"sensor"===b&&"timestamp"===f.device_class)try{return(0,c.r6)(new Date(y),e,s)}catch(t){return y}return m?.translation_key&&t(`component.${m.platform}.entity.${b}.${m.translation_key}.state.${y}`)||f.device_class&&t(`component.${b}.entity_component.${f.device_class}.state.${y}`)||t(`component.${b}.entity_component._.state.${y}`)||y};s()}catch(t){s(t)}}))},86134:(t,e,i)=>{i.d(e,{X:()=>s});const s=5},11630:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{IQ:()=>_,Jo:()=>h,Mm:()=>$,qc:()=>H});i(89655),i(54774),i(24545),i(51855),i(82130),i(31743),i(22328),i(4959),i(62435),i(253),i(2075),i(94438),i(54846),i(16891),i(4525);var n=i(213),r=i(64741),o=i(19244),a=t([r]);r=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],l=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],d=(t,e)=>!t.states[e]||u.includes((0,n.m)(e)),h=(t,e,i,s,n)=>{const r={type:"history/stream",entity_ids:n,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!n.some((e=>d(t,e)))},o=new m(t);return t.connection.subscribeMessage((t=>e(o.processMessage(t))),r)};class m{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const t of Object.keys(this.combinedHistory))i[t]=[];for(const e of Object.keys(t.states))i[e]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],n=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<n.lu&&(i[s]=i[s].sort(((t,e)=>t.lu-e.lu)))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter((t=>t.lu<e));if(!t.length)continue;if(i[s]=i[s].filter((t=>t.lu>=e)),i[s].length&&i[s][0].lu===e)continue;const n=t[t.length-1];n.lu=e,i[s].unshift(n)}}return this.combinedHistory=i,this.combinedHistory}}const _=(t,e,i,s,n=!0,r=!0,o)=>{const a={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:n,significant_changes_only:r,no_attributes:o??!s.some((e=>d(t,e)))},c=new m(t,i);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),a)},f=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||l.every((i=>t.attributes[i]===e.attributes[i]))),y=(t,e,i,s,n,a,c)=>{const u=[],l=a[0];for(const o of a){if(u.length>0&&o.s===u[u.length-1].state)continue;const a={};c?.attributes.device_class&&(a.device_class=c?.attributes.device_class),u.push({state_localize:(0,r.J)(t,e,[],i,s[n],n,{...o.a||l.a,...a},o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o._)(n,c?.attributes||l.a),entity_id:n,data:u}},b=(t,e,i,s)=>{const r=[];return Object.keys(i).forEach((t=>{const e=i[t],a=e[0],u=(0,n.m)(t),d=[];for(const t of e){let e;if(c.includes(u)){e={state:t.s,last_changed:1e3*t.lu,attributes:{}};for(const i of l)i in t.a&&(e.attributes[i]=t.a[i])}else e={state:t.s,last_changed:1e3*(t.lc?t.lc:t.lu),attributes:{}};d.length>1&&f(e,d[d.length-1])&&f(e,d[d.length-2])||d.push(e)}const h=t in s?s[t].attributes:"friendly_name"in a.a?a.a:void 0;r.push({domain:u,name:(0,o._)(t,h||{}),entity_id:t,states:d})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:r}},g=["counter","input_number","number"],v=t=>g.includes(t),p=t=>"unit_of_measurement"in t||"state_class"in t,k=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),w=" ",$=(t,e,i,s,r,o=!1,a=!1)=>{const c={},u=[],l={};if(new Set([...i,...Object.keys(e)]).forEach((i=>{i in e?l[i]=e[i]:t.states[i]&&(l[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])})),!l)return{line:[],timeline:[]};Object.keys(l).forEach((e=>{const i=l[e];if(0===i.length)return;const d=(0,n.m)(e),h=e in t.states?t.states[e]:void 0,m=h||v(d)?void 0:i.find((t=>t.a&&p(t.a)));let _;_=a||v(d)||null!=h&&p(h.attributes)||null!=h&&"sensor"===d&&k(h,r)||null!=m?h?.attributes.unit_of_measurement||m?.a.unit_of_measurement||w:{zone:s("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[d];const f=H(_,{climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[d]||(h?.attributes||m?.a)?.device_class,o);_?f&&f in c&&e in c[f]?c[f][e].push(...i):f&&(f in c||(c[f]={}),c[f][e]=i):u.push(y(s,t.locale,t.config,t.entities,e,i,h))}));return{line:Object.keys(c).map((e=>{const i=e.split("_"),s=i[0],n=i[1]||void 0;return b(s,n,c[e],t.states)})),timeline:u}},H=(t,e,i)=>i?`${t}_${e||""}`:t;s()}catch(t){s(t)}}))},40995:(t,e,i)=>{i.d(e,{a:()=>a});i(89655),i(253),i(2075),i(54846),i(16891),i(37679);var s=i(86134);const n=t=>t.reduce(((t,e)=>t+parseFloat(e.state)),0)/t.length,r=t=>parseFloat(t[t.length-1].state)||0,o=(t,e,i,o,a)=>{t.forEach((t=>{t.state=Number(t.state)})),t=t.filter((t=>!Number.isNaN(t.state)));const c=void 0!==a?.min?a.min:Math.min(...t.map((t=>t.state))),u=void 0!==a?.max?a.max:Math.max(...t.map((t=>t.state))),l=(new Date).getTime(),d=(t,i,s)=>{const n=l-new Date(i.last_changed).getTime();let r=Math.abs(n/36e5-e);return s?(r=60*(r-Math.floor(r)),r=Number((10*Math.round(r/10)).toString()[0])):r=Math.floor(r),t[r]||(t[r]=[]),t[r].push(i),t};if(t=t.reduce(((t,e)=>d(t,e,!1)),[]),o>1&&(t=t.map((t=>t.reduce(((t,e)=>d(t,e,!0)),[])))),t.length)return((t,e,i,o,a,c)=>{const u=[];let l=(c-a)/80;l=0!==l?l:80;let d=i/(e-(1===o?1:0));d=isFinite(d)?d:i;let h=t.filter(Boolean)[0];o>1&&(h=h.filter(Boolean)[0]);let m=[n(h),r(h)];const _=t=>80+s.X/2-(t-a)/l,f=(t,e,i=0,s=1)=>{if(s>1&&t)return t.forEach(((t,i)=>f(t,e,i,s-1)));const o=d*(e+i/6);t&&(m=[n(t),r(t)]);const a=_(t?m[0]:m[1]);return u.push([o,a])};for(let e=0;e<t.length;e+=1)f(t[e],e,0,o);return u.push([i,_(m[1])]),u})(t,e,i,o,c,u)},a=(t,e,i,s,n)=>{if(!t)return;const r=t.map((t=>({state:Number(t.s),last_changed:1e3*t.lu})));return o(r,e,i,s,n)}},34694:(t,e,i)=>{var s=i(36312),n=i(50289),r=i(29818),o=i(86134);i(253),i(2075);(0,s.A)([(0,r.EM)("hui-graph-base")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,r.MZ)()],key:"coordinates",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_path",value:void 0},{kind:"method",key:"render",value:function(){return n.qy` ${this._path?n.JW`<svg width="100%" height="100%" viewBox="0 0 500 100"> <g> <mask id="fill"> <path class="fill" fill="white" d="${this._path} L 500, 100 L 0, 100 z"/> </mask> <rect height="100%" width="100%" id="fill-rect" fill="var(--accent-color)" mask="url(#fill)"></rect> <mask id="line"> <path fill="none" stroke="var(--accent-color)" stroke-width="${o.X}" stroke-linecap="round" stroke-linejoin="round" d="${this._path}"></path> </mask> <rect height="100%" width="100%" id="rect" fill="var(--accent-color)" mask="url(#line)"></rect> </g> </svg>`:n.JW`<svg width="100%" height="100%" viewBox="0 0 500 100"></svg>`} `}},{kind:"method",key:"willUpdate",value:function(t){this.coordinates&&t.has("coordinates")&&(this._path=(t=>{if(!t.length)return"";let e,i,s="",n=t.filter(Boolean)[0];s+=`M ${n[0]},${n[1]}`;for(const u of t)e=u,r=n[0],o=n[1],a=e[0],c=e[1],i=[(r-a)/2+a,(o-c)/2+c],s+=` ${i[0]},${i[1]}`,s+=` Q${e[0]},${e[1]}`,n=e;var r,o,a,c;return s+=` ${e[0]},${e[1]}`,s})(this.coordinates))}},{kind:"get",static:!0,key:"styles",value:function(){return n.AH`:host{display:flex;width:100%}.fill{opacity:.1}`}}]}}),n.WF)},69272:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e),i.d(e,{HuiGraphHeaderFooter:()=>b});var n=i(36312),r=i(68689),o=i(50289),a=i(29818),c=i(33922),u=i(213),l=(i(32885),i(11630)),d=i(18102),h=i(40995),m=(i(34694),t([l]));l=(m.then?(await m)():m)[0];const _=6e4,f=60*_,y=["counter","input_number","number","sensor"];let b=(0,n.A)([(0,a.EM)("hui-graph-header-footer")],(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await i.e(96333).then(i.bind(i,96333)),document.createElement("hui-graph-footer-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"graph",entity:(0,d.B)(t,1,e,i,y,(t=>!isNaN(Number(t.state))&&!!t.attributes.unit_of_measurement))[0]||""}}},{kind:"field",decorators:[(0,a.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,a.MZ)()],key:"type",value:void 0},{kind:"field",decorators:[(0,a.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,a.wk)()],key:"_coordinates",value:void 0},{kind:"field",key:"_error",value:void 0},{kind:"field",key:"_interval",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){if(!t?.entity||!y.includes((0,u.m)(t.entity)))throw new Error("Specify an entity from within the sensor domain");const e={detail:1,hours_to_show:24,...t};e.hours_to_show=Number(e.hours_to_show),e.detail=1===e.detail||2===e.detail?e.detail:1,this._config=e}},{kind:"method",key:"render",value:function(){return this._config&&this.hass?this._error?o.qy`<div class="errors">${this._error}</div>`:this._coordinates?this._coordinates.length?o.qy` <hui-graph-base .coordinates="${this._coordinates}"></hui-graph-base> `:o.qy` <div class="container"> <div class="info">No state history found.</div> </div> `:o.qy` <div class="container"> <ha-circular-progress indeterminate size="small"></ha-circular-progress> </div> `:o.s6}},{kind:"method",key:"connectedCallback",value:function(){(0,r.A)(s,"connectedCallback",this,3)([]),this.hasUpdated&&this._config&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,r.A)(s,"disconnectedCallback",this,3)([]),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){(0,c.x)(this.hass,"history")&&!this._subscribed&&this._config&&(this._subscribed=(0,l.IQ)(this.hass,(t=>{this._subscribed&&this._config&&(this._coordinates=(0,h.a)(t[this._config.entity],this._config.hours_to_show,500,this._config.detail,this._config.limits)||[])}),this._config.hours_to_show,[this._config.entity]).catch((t=>{this._subscribed=void 0,this._error=t})),this._setRedrawTimer())}},{kind:"method",key:"_redrawGraph",value:function(){this._coordinates&&(this._coordinates=[...this._coordinates])}},{kind:"method",key:"_setRedrawTimer",value:function(){clearInterval(this._interval),this._interval=window.setInterval((()=>this._redrawGraph()),this._config.hours_to_show>24?f:_)}},{kind:"method",key:"_unsubscribeHistory",value:function(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then((t=>t?.())),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){if(!this._config||!this.hass||!t.has("_config"))return;const e=t.get("_config");e&&this._subscribed&&e.entity===this._config.entity||(this._unsubscribeHistory(),this._subscribeHistory())}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`ha-circular-progress{position:absolute;top:calc(50% - 14px)}.container{display:flex;justify-content:center;position:relative;padding-bottom:20%}.info{position:absolute;top:calc(50% - 16px);color:var(--secondary-text-color)}`}}]}}),o.WF);s()}catch(t){s(t)}}))}};
//# sourceMappingURL=46891.lZ2wem1aRBM.js.map