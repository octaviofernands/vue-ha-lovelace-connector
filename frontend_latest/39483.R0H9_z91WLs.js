export const id=39483;export const ids=[39483,57540];export const modules={10469:(t,e,n)=>{n.d(e,{$:()=>o});n(89655);const o=(t,e)=>{const n={};for(const o of t){const t=e(o);t in n?n[t].push(o):n[t]=[o]}return n}},47076:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{AN:()=>P,B2:()=>C,BV:()=>z,DR:()=>R,E$:()=>N,GW:()=>M,KJ:()=>I,Q4:()=>S,RB:()=>$,WN:()=>W,X4:()=>X,_d:()=>U,al:()=>L,bs:()=>A,c:()=>D,gv:()=>Z,m7:()=>x,oU:()=>T,tb:()=>q,uh:()=>E,yM:()=>V});n(89655),n(253),n(54846),n(16891);var i=n(31195),s=n(77301),a=n(91103),r=n(39902),c=n(72730),l=n(61310),u=n(31293),g=n(63165),h=n(60132),f=n(83324),_=n(84280),d=n(94100),y=n(78691),m=n(41924),p=n(10469),v=n(31265),k=n(4826),b=t([y,m]);[y,m]=b.then?(await b)():b;const w=[],x=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),$=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),E=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),S=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),T=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),D=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),M=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),z=t=>t.callWS({type:"energy/info"}),C=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),A=t=>t.callWS({type:"energy/get_prefs"}),W=async(t,e)=>{const n=t.callWS({type:"energy/save_prefs",...e});return F(t),n},H=async(t,e,n,o,i,s="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:i?.toISOString(),energy_statistic_ids:n,co2_statistic_id:o,period:s}),N=t=>(0,p.$)(t.energy_sources,(t=>t.type)),P=(t,e,n)=>{const o=[];for(const i of t.energy_sources)if(!n||n.includes(i.type))if("solar"!==i.type)if("gas"!==i.type&&"water"!==i.type)if("battery"!==i.type){for(const t of i.flow_from){o.push(t.stat_energy_from),t.stat_cost&&o.push(t.stat_cost);const n=e.cost_sensors[t.stat_energy_from];n&&o.push(n)}for(const t of i.flow_to){o.push(t.stat_energy_to),t.stat_compensation&&o.push(t.stat_compensation);const n=e.cost_sensors[t.stat_energy_to];n&&o.push(n)}}else o.push(i.stat_energy_from),o.push(i.stat_energy_to);else{o.push(i.stat_energy_from),i.stat_cost&&o.push(i.stat_cost);const t=e.cost_sensors[i.stat_energy_from];t&&o.push(t)}else o.push(i.stat_energy_from);return n&&!n.includes("device")||o.push(...t.device_consumption.map((t=>t.stat_consumption))),o},j=async(t,e,n,o,g)=>{const[h,f]=await Promise.all([(0,v.VN)(t,{domain:"co2signal"}),z(t)]),_=h.length?h[0]:void 0;let d;if(_)for(const e of Object.values(t.entities)){if("co2signal"!==e.platform)continue;const n=t.states[e.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){d=n.entity_id;break}}const m=[];for(const t of e.energy_sources)if("grid"===t.type)for(const e of t.flow_from)m.push(e.stat_energy_from);const p=P(e,f,["grid","solar","battery","gas","device"]),b=P(e,f,["water"]),w=[...p,...b],x=(0,i.c)(o||new Date,n),$=x>35?"month":x>2?"day":"hour",E=t.config.unit_system.length||"",S={energy:"kWh",volume:"km"===E?"m続":"ft続"},T={volume:"km"===E?"L":"gal"},D=p.length?(0,k.sz)(t,n,o,p,$,S,["change"]):{},M=b.length?(0,k.sz)(t,n,o,b,$,T,["change"]):{};let C,A,W,N,j,F={},O={};g&&(A=(0,y.xo)(n,s.e,t.locale,t.config)&&(0,y.xo)(o||new Date,a.c,t.locale,t.config)?(0,y.ol)(n,r.P,t.locale,t.config,-(0,y.EO)(o||new Date,n,c.W,t.locale,t.config)-1):(0,y.ol)(n,l.f,t.locale,t.config,-1*(x+1)),W=(0,u.A)(n,-1),p.length&&(F=(0,k.sz)(t,A,W,p,$,S,["change"])),b.length&&(O=(0,k.sz)(t,A,W,b,$,T,["change"]))),void 0!==d&&(N=H(t,n,m,d,o,x>35?"month":x>2?"day":"hour"),g&&(j=H(t,A,m,d,W,x>35?"month":x>2?"day":"hour")));const q={},L=w.length?(0,k.Wr)(t,w):[],[B,U,I,V,X,Z,Q]=await Promise.all([D,M,F,O,L,N,j]),R={...B,...U};g&&(C={...I,...V}),w.length&&X.forEach((t=>{q[t.statistic_id]=t}));return{start:n,end:o,startCompare:A,endCompare:W,info:f,prefs:e,stats:R,statsMetadata:q,statsCompare:C,co2SignalConfigEntry:_,co2SignalEntity:d,fossilEnergyConsumption:Z,fossilEnergyConsumptionCompare:Q}},F=t=>{w.forEach((e=>{const n=q(t,{key:e});n.clearPrefs(),n._active&&n.refresh()}))},O=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout((()=>t.refresh()),e.getTime()-Date.now())}},q=(t,e={})=>{let n="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${e.key}`}if(t.connection[n])return t.connection[n];w.push(e.key);const o=(0,_.X)(t.connection,n,(async()=>(o.prefs||(o.prefs=await A(t)),O(o),j(t,o.prefs,o.start,o.end,o.compare)))),i=o.subscribe;o.subscribe=t=>{const e=i(t);return o._active++,void 0===o._refreshTimeout&&O(o),()=>{o._active--,o._active<1&&(clearTimeout(o._refreshTimeout),o._refreshTimeout=void 0),e()}},o._active=0,o.prefs=e.prefs;const s=new Date,a=(0,m.LW)(s,t.locale,t.config).split(":")[0];o.start=(0,y.ol)("0"===a?(0,l.f)(s,-1):s,g.o,t.locale,t.config),o.end=(0,y.ol)("0"===a?(0,l.f)(s,-1):s,h.D,t.locale,t.config);const r=()=>{o._updatePeriodTimeout=window.setTimeout((()=>{o.start=(0,y.ol)(new Date,g.o,t.locale,t.config),o.end=(0,y.ol)(new Date,h.D,t.locale,t.config),r()}),(0,f.L)((0,y.ol)(s,h.D,t.locale,t.config),1).getTime()-Date.now())};return r(),o.clearPrefs=()=>{o.prefs=void 0},o.setPeriod=(e,n)=>{o.start=e,o.end=n,o.start.getTime()!==(0,y.ol)(new Date,g.o,t.locale,t.config).getTime()||o.end?.getTime()!==(0,y.ol)(new Date,h.D,t.locale,t.config).getTime()||o._updatePeriodTimeout?o._updatePeriodTimeout&&(clearTimeout(o._updatePeriodTimeout),o._updatePeriodTimeout=void 0):r()},o.setCompare=t=>{o.compare=t},o},L=t=>t.callWS({type:"energy/solar_forecast"}),B=["volume","energy"],U=(t,e={},n)=>{for(const o of t.energy_sources){if("gas"!==o.type)continue;if(n&&n===o.stat_energy_from)continue;const t=e[o.stat_energy_from];if(B.includes(t?.unit_class))return t.unit_class}},I=(t,e,n={})=>{const o=U(e,n);if(void 0!==o)return"energy"===o?"kWh":"km"===t.config.unit_system.length?"m続":"ft続"},V=t=>"km"===t.config.unit_system.length?"L":"gal",X="/docs/energy/faq/#troubleshooting-missing-entities",Z=(0,d.A)((t=>({summedData:Q(t),compareSummedData:t.statsCompare?Q(t,!0):void 0}))),Q=(t,e)=>{const n={};for(const e of t.prefs.energy_sources)if("solar"!==e.type)if("battery"!==e.type){if("grid"===e.type){for(const t of e.flow_from)n.from_grid?n.from_grid.push(t.stat_energy_from):n.from_grid=[t.stat_energy_from];for(const t of e.flow_to)n.to_grid?n.to_grid.push(t.stat_energy_to):n.to_grid=[t.stat_energy_to]}}else n.to_battery?(n.to_battery.push(e.stat_energy_to),n.from_battery.push(e.stat_energy_from)):(n.to_battery=[e.stat_energy_to],n.from_battery=[e.stat_energy_from]);else n.solar?n.solar.push(e.stat_energy_from):n.solar=[e.stat_energy_from];const o={};return Object.entries(n).forEach((([n,i])=>{const s={},a={};i.forEach((n=>{const o=e?t.statsCompare[n]:t.stats[n];if(!o)return;o.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;s[t.start]=t.start in s?s[t.start]+e:e})),a[n]={}})),o[n]=s})),o},R=(0,d.A)(((t,e)=>({consumption:J(t),compareConsumption:e?J(e):void 0}))),J=t=>{const e={total:{}};return Object.keys(t).forEach((n=>{Object.keys(t[n]).forEach((n=>{if(void 0===e.total[n]){const o=(t.from_grid?.[n]||0)+(t.solar?.[n]||0)+(t.from_battery?.[n]||0)-(t.to_grid?.[n]||0)-(t.to_battery?.[n]||0);e.total[n]=o}}))})),e};o()}catch(t){o(t)}}))},39483:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.r(e);var i=n(36312),s=(n(253),n(16891),n(37679),n(7986),n(50289)),a=n(29818),r=n(55165),c=n(53249),l=(n(13082),n(43106)),u=(n(88400),n(47076)),g=n(4826),h=n(20712),f=n(46645),_=n(57540),d=n(7934),y=t([l,u,_]);[l,u,_]=y.then?(await y)():y;const m="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",p={maximumFractionDigits:0};(0,i.A)([(0,a.EM)("hui-energy-carbon-consumed-gauge-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,a.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,a.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,a.wk)()],key:"_data",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"getCardSize",value:function(){return 4}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"hassSubscribe",value:function(){return[(0,u.tb)(this.hass,{key:this._config?.collection_key}).subscribe((t=>{this._data=t}))]}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,d.xP)(this,t)||t.size>1||!t.has("hass")||!!this._data?.co2SignalEntity&&this.hass.states[this._data.co2SignalEntity]!==t.get("hass").states[this._data.co2SignalEntity]}},{kind:"method",key:"render",value:function(){if(!this._config||!this.hass)return s.s6;if(!this._data)return s.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.loading")}`;if(!this._data.co2SignalEntity)return s.s6;if(!this.hass.states[this._data.co2SignalEntity])return s.qy`<hui-warning> ${(0,f.j)(this.hass,this._data.co2SignalEntity)} </hui-warning>`;const t=this._data.prefs,e=(0,u.E$)(t),n=(0,g.gF)(this._data.stats,e.grid[0].flow_from.map((t=>t.stat_energy_from)));let o;if(this._data.fossilEnergyConsumption&&n){const t=this._data.fossilEnergyConsumption?Object.values(this._data.fossilEnergyConsumption).reduce(((t,e)=>t+e),0):0,i=e.solar&&(0,g.gF)(this._data.stats,e.solar.map((t=>t.stat_energy_from)))||0,s=(0,g.gF)(this._data.stats,e.grid[0].flow_to.map((t=>t.stat_energy_to)))||0,a=n+Math.max(0,i-s);o=(0,c.L)(100*(1-t/a))}return s.qy` <ha-card> ${void 0!==o?s.qy` <ha-svg-icon id="info" .path="${m}"></ha-svg-icon> <simple-tooltip animation-delay="0" for="info" position="left"> <span> ${this.hass.localize("ui.panel.lovelace.cards.energy.carbon_consumed_gauge.card_indicates_energy_used")} </span> </simple-tooltip> <ha-gauge min="0" max="100" .value="${o}" .formatOptions="${p}" .locale="${this.hass.locale}" label="%" style="${(0,r.W)({"--gauge-color":this._computeSeverity(o)})}"></ha-gauge> <div class="name"> ${this.hass.localize("ui.panel.lovelace.cards.energy.carbon_consumed_gauge.low_carbon_energy_consumed")} </div> `:s.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.carbon_consumed_gauge.low_carbon_energy_not_calculated")}`} </ha-card> `}},{kind:"method",key:"_computeSeverity",value:function(t){return t<10?_.severityMap.red:t<30?_.severityMap.yellow:t>75?_.severityMap.green:_.severityMap.normal}},{kind:"get",static:!0,key:"styles",value:function(){return s.AH`ha-card{height:100%;overflow:hidden;padding:16px;display:flex;align-items:center;justify-content:center;flex-direction:column;box-sizing:border-box}ha-gauge{width:100%;max-width:250px}.name{text-align:center;line-height:initial;color:var(--primary-text-color);width:100%;font-size:15px;margin-top:8px}ha-svg-icon{position:absolute;right:4px;inset-inline-end:4px;inset-inline-start:initial;top:4px;color:var(--secondary-text-color)}simple-tooltip>span{font-size:12px;line-height:12px}simple-tooltip{width:80%;max-width:250px;top:8px!important}`}}]}}),(0,h.E)(s.WF));o()}catch(t){o(t)}}))},57540:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.r(e),n.d(e,{DEFAULT_MAX:()=>E,DEFAULT_MIN:()=>$,severityMap:()=>S});var i=n(36312),s=n(68689),a=(n(16891),n(50289)),r=n(29818),c=n(10977),l=n(85323),u=n(55165),g=n(38962),h=n(19244),f=n(26175),_=n(57636),d=(n(13082),n(43106)),y=n(9883),m=n(25319),p=n(18102),v=n(63582),k=n(562),b=n(7934),w=n(46645),x=t([_,d]);[_,d]=x.then?(await x)():x;const $=0,E=100,S={red:"var(--error-color)",green:"var(--success-color)",yellow:"var(--warning-color)",normal:"var(--info-color)"};(0,i.A)([(0,r.EM)("hui-gauge-card")],(function(t,e){class o extends e{constructor(...e){super(...e),t(this)}}return{F:o,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await n.e(59149).then(n.bind(n,59149)),document.createElement("hui-gauge-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,n){return{type:"gauge",entity:(0,p.B)(t,1,e,n,["counter","input_number","number","sensor"],(t=>!isNaN(Number(t.state))))[0]||""}}},{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_config",value:void 0},{kind:"method",key:"getCardSize",value:function(){return 4}},{kind:"method",key:"setConfig",value:function(t){if(!t.entity)throw new Error("Entity must be specified");if(!(0,f.n)(t.entity))throw new Error("Invalid entity");this._config={min:$,max:E,...t}}},{kind:"method",key:"render",value:function(){if(!this._config||!this.hass)return a.s6;const t=this.hass.states[this._config.entity];if(!t)return a.qy` <hui-warning> ${(0,w.j)(this.hass,this._config.entity)} </hui-warning> `;const e=Number(t.state);if(t.state===y.Hh)return a.qy` <hui-warning>${this.hass.localize("ui.panel.lovelace.warning.entity_unavailable",{entity:this._config.entity})}</hui-warning> `;if(isNaN(e))return a.qy` <hui-warning>${this.hass.localize("ui.panel.lovelace.warning.entity_non_numeric",{entity:this._config.entity})}</hui-warning> `;const n=this._config.name??(0,h.u)(t);return a.qy` <ha-card class="${(0,l.H)({action:(0,k.A)(this._config)})}" @action="${this._handleAction}" .actionHandler="${(0,m.T)({hasHold:(0,k.h)(this._config.hold_action),hasDoubleClick:(0,k.h)(this._config.double_tap_action)})}" tabindex="${(0,c.J)(!this._config.tap_action||(0,k.h)(this._config.tap_action)?"0":void 0)}"> <ha-gauge .min="${this._config.min}" .max="${this._config.max}" .value="${t.state}" .formatOptions="${(0,_.ZQ)(t,this.hass.entities[t.entity_id])}" .locale="${this.hass.locale}" .label="${this._config.unit||this.hass?.states[this._config.entity].attributes.unit_of_measurement||""}" style="${(0,u.W)({"--gauge-color":this._computeSeverity(e)})}" .needle="${this._config.needle}" .levels="${this._config.needle?this._severityLevels():void 0}"></ha-gauge> <div class="name" .title="${n}">${n}</div> </ha-card> `}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,b.LX)(this,t)}},{kind:"method",key:"updated",value:function(t){if((0,s.A)(o,"updated",this,3)([t]),!this._config||!this.hass)return;const e=t.get("hass"),n=t.get("_config");e&&n&&e.themes===this.hass.themes&&n.theme===this._config.theme||(0,g.Q)(this,this.hass.themes,this._config.theme)}},{kind:"method",key:"_computeSeverity",value:function(t){if(this._config.needle)return;let e=this._config.segments;if(e){e=[...e].sort(((t,e)=>t.from-e.from));for(let n=0;n<e.length;n++){const o=e[n];if(o&&t>=o.from&&(n+1===e.length||t<e[n+1]?.from))return o.color}return S.normal}const n=this._config.severity;if(!n)return S.normal;const o=Object.keys(n).map((t=>[t,n[t]]));for(const t of o)if(null==S[t[0]]||isNaN(t[1]))return S.normal;return o.sort(((t,e)=>t[1]-e[1])),t>=o[0][1]&&t<o[1][1]?S[o[0][0]]:t>=o[1][1]&&t<o[2][1]?S[o[1][0]]:t>=o[2][1]?S[o[2][0]]:S.normal}},{kind:"method",key:"_severityLevels",value:function(){const t=this._config.segments;if(t)return t.map((t=>({level:t?.from,stroke:t?.color,label:t?.label})));const e=this._config.severity;if(!e)return[{level:0,stroke:S.normal}];return Object.keys(e).map((t=>({level:e[t],stroke:S[t]})))}},{kind:"method",key:"_handleAction",value:function(t){(0,v.$)(this,this.hass,this._config,t.detail.action)}},{kind:"get",static:!0,key:"styles",value:function(){return a.AH`ha-card{height:100%;overflow:hidden;padding:16px;display:flex;align-items:center;justify-content:center;flex-direction:column;box-sizing:border-box}ha-card.action{cursor:pointer}ha-card:focus{outline:0}ha-gauge{width:100%;max-width:250px}.name{text-align:center;line-height:initial;color:var(--primary-text-color);width:100%;font-size:15px;margin-top:8px}`}}]}}),a.WF);o()}catch(t){o(t)}}))},24226:(t,e,n)=>{n.d(e,{z:()=>i});var o=n(30429);function i(t,e){const n=(0,o.a)(t),i=(0,o.a)(e),s=n.getTime()-i.getTime();return s<0?-1:s>0?1:s}},72730:(t,e,n)=>{n.d(e,{W:()=>r});var o=n(24226),i=n(30429);function s(t,e){const n=(0,i.a)(t),o=(0,i.a)(e);return 12*(n.getFullYear()-o.getFullYear())+(n.getMonth()-o.getMonth())}var a=n(91103);function r(t,e){const n=(0,i.a)(t),r=(0,i.a)(e),c=(0,o.z)(n,r),l=Math.abs(s(n,r));let u;if(l<1)u=0;else{1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-c*l);let e=(0,o.z)(n,r)===-c;(0,a.c)((0,i.a)(t))&&1===l&&1===(0,o.z)(t,r)&&(e=!1),u=c*(l-Number(e))}return 0===u?0:u}},77301:(t,e,n)=>{n.d(e,{e:()=>i});var o=n(30429);function i(t){return 1===(0,o.a)(t).getDate()}},91103:(t,e,n)=>{n.d(e,{c:()=>a});var o=n(60132),i=n(12152),s=n(30429);function a(t){const e=(0,s.a)(t);return+(0,o.D)(e)==+(0,i.p)(e)}}};
//# sourceMappingURL=39483.R0H9_z91WLs.js.map