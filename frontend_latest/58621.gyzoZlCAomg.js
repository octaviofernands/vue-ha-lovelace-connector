export const id=58621;export const ids=[58621];export const modules={10469:(t,e,o)=>{o.d(e,{$:()=>n});o(89655);const n=(t,e)=>{const o={};for(const n of t){const t=e(n);t in o?o[t].push(n):o[t]=[n]}return o}},47076:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{AN:()=>V,B2:()=>C,BV:()=>P,DR:()=>Q,E$:()=>L,GW:()=>E,KJ:()=>I,Q4:()=>S,RB:()=>k,WN:()=>z,X4:()=>Y,_d:()=>H,al:()=>B,bs:()=>$,c:()=>W,gv:()=>Z,m7:()=>D,oU:()=>M,tb:()=>R,uh:()=>x,yM:()=>U});o(89655),o(253),o(54846),o(16891);var r=o(31195),s=o(77301),a=o(91103),i=o(39902),c=o(72730),l=o(61310),f=o(31293),_=o(63165),g=o(60132),u=o(83324),y=o(84280),m=o(94100),d=o(78691),p=o(41924),h=o(10469),b=o(31265),v=o(4826),w=t([d,p]);[d,p]=w.then?(await w)():w;const T=[],D=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),x=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),S=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),M=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),W=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),E=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=t=>t.callWS({type:"energy/info"}),C=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),$=t=>t.callWS({type:"energy/get_prefs"}),z=async(t,e)=>{const o=t.callWS({type:"energy/save_prefs",...e});return A(t),o},O=async(t,e,o,n,r,s="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:r?.toISOString(),energy_statistic_ids:o,co2_statistic_id:n,period:s}),L=t=>(0,h.$)(t.energy_sources,(t=>t.type)),V=(t,e,o)=>{const n=[];for(const r of t.energy_sources)if(!o||o.includes(r.type))if("solar"!==r.type)if("gas"!==r.type&&"water"!==r.type)if("battery"!==r.type){for(const t of r.flow_from){n.push(t.stat_energy_from),t.stat_cost&&n.push(t.stat_cost);const o=e.cost_sensors[t.stat_energy_from];o&&n.push(o)}for(const t of r.flow_to){n.push(t.stat_energy_to),t.stat_compensation&&n.push(t.stat_compensation);const o=e.cost_sensors[t.stat_energy_to];o&&n.push(o)}}else n.push(r.stat_energy_from),n.push(r.stat_energy_to);else{n.push(r.stat_energy_from),r.stat_cost&&n.push(r.stat_cost);const t=e.cost_sensors[r.stat_energy_from];t&&n.push(t)}else n.push(r.stat_energy_from);return o&&!o.includes("device")||n.push(...t.device_consumption.map((t=>t.stat_consumption))),n},j=async(t,e,o,n,_)=>{const[g,u]=await Promise.all([(0,b.VN)(t,{domain:"co2signal"}),P(t)]),y=g.length?g[0]:void 0;let m;if(y)for(const e of Object.values(t.entities)){if("co2signal"!==e.platform)continue;const o=t.states[e.entity_id];if(o&&"%"===o.attributes.unit_of_measurement){m=o.entity_id;break}}const p=[];for(const t of e.energy_sources)if("grid"===t.type)for(const e of t.flow_from)p.push(e.stat_energy_from);const h=V(e,u,["grid","solar","battery","gas","device"]),w=V(e,u,["water"]),T=[...h,...w],D=(0,r.c)(n||new Date,o),k=D>35?"month":D>2?"day":"hour",x=t.config.unit_system.length||"",S={energy:"kWh",volume:"km"===x?"m³":"ft³"},M={volume:"km"===x?"L":"gal"},W=h.length?(0,v.sz)(t,o,n,h,k,S,["change"]):{},E=w.length?(0,v.sz)(t,o,n,w,k,M,["change"]):{};let C,$,z,L,j,A={},N={};_&&($=(0,d.xo)(o,s.e,t.locale,t.config)&&(0,d.xo)(n||new Date,a.c,t.locale,t.config)?(0,d.ol)(o,i.P,t.locale,t.config,-(0,d.EO)(n||new Date,o,c.W,t.locale,t.config)-1):(0,d.ol)(o,l.f,t.locale,t.config,-1*(D+1)),z=(0,f.A)(o,-1),h.length&&(A=(0,v.sz)(t,$,z,h,k,S,["change"])),w.length&&(N=(0,v.sz)(t,$,z,w,k,M,["change"]))),void 0!==m&&(L=O(t,o,p,m,n,D>35?"month":D>2?"day":"hour"),_&&(j=O(t,$,p,m,z,D>35?"month":D>2?"day":"hour")));const R={},B=T.length?(0,v.Wr)(t,T):[],[F,H,I,U,Y,Z,K]=await Promise.all([W,E,A,N,B,L,j]),Q={...F,...H};_&&(C={...I,...U}),T.length&&Y.forEach((t=>{R[t.statistic_id]=t}));return{start:o,end:n,startCompare:$,endCompare:z,info:u,prefs:e,stats:Q,statsMetadata:R,statsCompare:C,co2SignalConfigEntry:y,co2SignalEntity:m,fossilEnergyConsumption:Z,fossilEnergyConsumptionCompare:K}},A=t=>{T.forEach((e=>{const o=R(t,{key:e});o.clearPrefs(),o._active&&o.refresh()}))},N=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout((()=>t.refresh()),e.getTime()-Date.now())}},R=(t,e={})=>{let o="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");o=`_${e.key}`}if(t.connection[o])return t.connection[o];T.push(e.key);const n=(0,y.X)(t.connection,o,(async()=>(n.prefs||(n.prefs=await $(t)),N(n),j(t,n.prefs,n.start,n.end,n.compare)))),r=n.subscribe;n.subscribe=t=>{const e=r(t);return n._active++,void 0===n._refreshTimeout&&N(n),()=>{n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),e()}},n._active=0,n.prefs=e.prefs;const s=new Date,a=(0,p.LW)(s,t.locale,t.config).split(":")[0];n.start=(0,d.ol)("0"===a?(0,l.f)(s,-1):s,_.o,t.locale,t.config),n.end=(0,d.ol)("0"===a?(0,l.f)(s,-1):s,g.D,t.locale,t.config);const i=()=>{n._updatePeriodTimeout=window.setTimeout((()=>{n.start=(0,d.ol)(new Date,_.o,t.locale,t.config),n.end=(0,d.ol)(new Date,g.D,t.locale,t.config),i()}),(0,u.L)((0,d.ol)(s,g.D,t.locale,t.config),1).getTime()-Date.now())};return i(),n.clearPrefs=()=>{n.prefs=void 0},n.setPeriod=(e,o)=>{n.start=e,n.end=o,n.start.getTime()!==(0,d.ol)(new Date,_.o,t.locale,t.config).getTime()||n.end?.getTime()!==(0,d.ol)(new Date,g.D,t.locale,t.config).getTime()||n._updatePeriodTimeout?n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0):i()},n.setCompare=t=>{n.compare=t},n},B=t=>t.callWS({type:"energy/solar_forecast"}),F=["volume","energy"],H=(t,e={},o)=>{for(const n of t.energy_sources){if("gas"!==n.type)continue;if(o&&o===n.stat_energy_from)continue;const t=e[n.stat_energy_from];if(F.includes(t?.unit_class))return t.unit_class}},I=(t,e,o={})=>{const n=H(e,o);if(void 0!==n)return"energy"===n?"kWh":"km"===t.config.unit_system.length?"m³":"ft³"},U=t=>"km"===t.config.unit_system.length?"L":"gal",Y="/docs/energy/faq/#troubleshooting-missing-entities",Z=(0,m.A)((t=>({summedData:K(t),compareSummedData:t.statsCompare?K(t,!0):void 0}))),K=(t,e)=>{const o={};for(const e of t.prefs.energy_sources)if("solar"!==e.type)if("battery"!==e.type){if("grid"===e.type){for(const t of e.flow_from)o.from_grid?o.from_grid.push(t.stat_energy_from):o.from_grid=[t.stat_energy_from];for(const t of e.flow_to)o.to_grid?o.to_grid.push(t.stat_energy_to):o.to_grid=[t.stat_energy_to]}}else o.to_battery?(o.to_battery.push(e.stat_energy_to),o.from_battery.push(e.stat_energy_from)):(o.to_battery=[e.stat_energy_to],o.from_battery=[e.stat_energy_from]);else o.solar?o.solar.push(e.stat_energy_from):o.solar=[e.stat_energy_from];const n={};return Object.entries(o).forEach((([o,r])=>{const s={},a={};r.forEach((o=>{const n=e?t.statsCompare[o]:t.stats[o];if(!n)return;n.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;s[t.start]=t.start in s?s[t.start]+e:e})),a[o]={}})),n[o]=s})),n},Q=(0,m.A)(((t,e)=>({consumption:X(t),compareConsumption:e?X(e):void 0}))),X=t=>{const e={total:{}};return Object.keys(t).forEach((o=>{Object.keys(t[o]).forEach((o=>{if(void 0===e.total[o]){const n=(t.from_grid?.[o]||0)+(t.solar?.[o]||0)+(t.from_battery?.[o]||0)-(t.to_grid?.[o]||0)-(t.to_battery?.[o]||0);e.total[o]=n}}))})),e};n()}catch(t){n(t)}}))},23469:(t,e,o)=>{o.d(e,{g:()=>s});var n=o(45253),r=o(92164);function s(t,e,o,s,a,i){const c=t.getPropertyValue(a+"-"+i).trim(),l=c.length>0?c:t.getPropertyValue(a).trim();let f=(0,n.RQ)(l);return 0===c.length&&i&&(f=(0,n.v2)((0,n.BE)(e?(0,r.T)((0,n.Nc)((0,n.xp)(f)),i):(0,r.d)((0,n.Nc)((0,n.xp)(f)),i)))),s?f+=o?"32":"7F":o&&(f+="7F"),f}},37334:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{o:()=>u});var r=o(65513),s=o(31195),a=o(6711),i=o(83324),c=o(57636),l=o(57289),f=o(41924),_=t([c,l,f]);function g(t,e){let o=new Date(e);return t>2&&0===o.getHours()&&(o=(0,r.O)(o,1)),o.setMinutes(0,0,0),t>35&&o.setDate(1),t>2&&o.setHours(0),o.getTime()}function u(t,e,o,n,r,_,u){const y=(0,s.c)(e,t),m=void 0!==_&&void 0!==u;if(m&&y<=35){const o=(0,a.M)(e,t),n=(0,a.M)(u,_);n>o?e=(0,i.L)(e,n-o):o>n&&(u=(0,i.L)(u,o-n))}const d={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:g(y,e),adapters:{date:{locale:o,config:n}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:y>35?"monthyear":y>7?"date":y>2?"weekday":y>0?"datetime":"hour",minUnit:y>35?"month":y>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:r},ticks:{beginAtZero:!0,callback:t=>(0,c.ZV)(Math.abs(t),o)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(y>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${m?`${(0,l.sl)(e,o,n)}: `:""}${(0,f.fU)(e,o,n)} – ${(0,f.fU)((0,i.L)(e,1),o,n)}`},label:t=>`${t.dataset.label}: ${(0,c.ZV)(t.parsed.y,o)} ${r}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,c.Yf)(o)};return m&&(d.scales.xAxisCompare={...d.scales.x,suggestedMin:_.getTime(),max:g(y,u),display:!1}),d}[c,l,f]=_.then?(await _)():_,n()}catch(y){n(y)}}))},24226:(t,e,o)=>{o.d(e,{z:()=>r});var n=o(30429);function r(t,e){const o=(0,n.a)(t),r=(0,n.a)(e),s=o.getTime()-r.getTime();return s<0?-1:s>0?1:s}},72730:(t,e,o)=>{o.d(e,{W:()=>i});var n=o(24226),r=o(30429);function s(t,e){const o=(0,r.a)(t),n=(0,r.a)(e);return 12*(o.getFullYear()-n.getFullYear())+(o.getMonth()-n.getMonth())}var a=o(91103);function i(t,e){const o=(0,r.a)(t),i=(0,r.a)(e),c=(0,n.z)(o,i),l=Math.abs(s(o,i));let f;if(l<1)f=0;else{1===o.getMonth()&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-c*l);let e=(0,n.z)(o,i)===-c;(0,a.c)((0,r.a)(t))&&1===l&&1===(0,n.z)(t,i)&&(e=!1),f=c*(l-Number(e))}return 0===f?0:f}},75697:(t,e,o)=>{o.d(e,{o:()=>r});var n=o(60132);function r(){return(0,n.D)(Date.now())}},77301:(t,e,o)=>{o.d(e,{e:()=>r});var n=o(30429);function r(t){return 1===(0,n.a)(t).getDate()}},91103:(t,e,o)=>{o.d(e,{c:()=>a});var n=o(60132),r=o(12152),s=o(30429);function a(t){const e=(0,s.a)(t);return+(0,n.D)(e)==+(0,r.p)(e)}},65513:(t,e,o)=>{o.d(e,{O:()=>r});var n=o(83324);function r(t,e){return(0,n.L)(t,-e)}}};
//# sourceMappingURL=58621.gyzoZlCAomg.js.map