export const id=22660;export const ids=[22660];export const modules={31232:(e,t,a)=>{a.d(t,{F:()=>s,r:()=>o});a(253),a(4525);const i=/{%|{{/,s=e=>i.test(e),o=e=>{if(!e)return!1;if("string"==typeof e)return s(e);if("object"==typeof e){return(Array.isArray(e)?e:Object.values(e)).some((e=>e&&o(e)))}return!1}},22660:(e,t,a)=>{a.r(t);var i=a(36312),s=a(68689),o=(a(89655),a(253),a(2075),a(94438),a(54846),a(16891),a(4525),a(32707)),r=a(51431),l=a(50289),n=a(29818),c=a(94100),d=a(96979),h=a(213),v=a(59780),p=a(31232),u=a(56932),_=a(18589),m=a(32920),y=(a(94548),a(13082),a(13292),a(77372),a(15720),a(4169),a(95113),a(5348),a(57641),a(39914)),f=a(55979),b=a(54525),k=a(55321),g=a(84976);(0,i.A)([(0,n.EM)("developer-tools-action")],(function(e,t){class a extends t{constructor(...t){super(...t),e(this)}}return{F:a,d:[{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.MZ)({type:Boolean})],key:"narrow",value:()=>!1},{kind:"field",decorators:[(0,n.wk)()],key:"_uiAvailable",value:()=>!0},{kind:"field",decorators:[(0,n.wk)()],key:"_response",value:void 0},{kind:"field",decorators:[(0,n.wk)()],key:"_error",value:void 0},{kind:"field",key:"_yamlValid",value:()=>!0},{kind:"field",decorators:[(0,d.I)({key:"panel-dev-action-state-service-data",state:!0,subscribe:!1})],key:"_serviceData",value:()=>({action:"",target:{},data:{}})},{kind:"field",decorators:[(0,d.I)({key:"panel-dev-action-state-yaml-mode",state:!0,subscribe:!1})],key:"_yamlMode",value:()=>!1},{kind:"field",decorators:[(0,n.P)("#yaml-editor")],key:"_yamlEditor",value:void 0},{kind:"method",key:"firstUpdated",value:function(e){(0,s.A)(a,"firstUpdated",this,3)([e]),this.hass.loadBackendTranslation("services"),this.hass.loadBackendTranslation("selector");const t=(0,u.p9)("service");if(t)this._serviceData={action:t,target:{},data:{}},this._yamlMode&&this.updateComplete.then((()=>this._yamlEditor?.setValue(this._serviceData)));else if(!this._serviceData?.action){const e=Object.keys(this.hass.services).sort()[0],t=Object.keys(this.hass.services[e]).sort()[0];this._serviceData={action:`${e}.${t}`,target:{},data:{}},this._yamlMode&&this.updateComplete.then((()=>this._yamlEditor?.setValue(this._serviceData)))}this._checkUiSupported()}},{kind:"method",key:"render",value:function(){const{target:e,fields:t}=this._fields(this.hass.services,this._serviceData?.action),a=this._serviceData?.action?(0,h.m)(this._serviceData?.action):void 0,i=this._serviceData?.action?(0,v.Y)(this._serviceData?.action):void 0;return l.qy` <div class="content"> <p> ${this.hass.localize("ui.panel.developer-tools.tabs.actions.description")} </p> <ha-card> ${this._yamlMode?l.qy`<div class="card-content"> <ha-service-picker .hass="${this.hass}" .value="${this._serviceData?.action}" @value-changed="${this._serviceChanged}"></ha-service-picker> <ha-yaml-editor id="yaml-editor" .hass="${this.hass}" .defaultValue="${this._serviceData}" @value-changed="${this._yamlChanged}"></ha-yaml-editor> </div>`:l.qy` <ha-service-control .hass="${this.hass}" .value="${this._serviceData}" .narrow="${this.narrow}" showAdvanced @value-changed="${this._serviceDataChanged}" class="card-content"></ha-service-control> `} ${void 0!==this._error?l.qy`<ha-alert alert-type="error">${this._error}</ha-alert>`:l.s6} </ha-card> </div> <div class="button-row"> <div class="buttons"> <div class="switch-mode-container"> <mwc-button @click="${this._toggleYaml}" .disabled="${!this._uiAvailable}"> ${this._yamlMode?this.hass.localize("ui.panel.developer-tools.tabs.actions.ui_mode"):this.hass.localize("ui.panel.developer-tools.tabs.actions.yaml_mode")} </mwc-button> ${this._uiAvailable?"":l.qy`<span class="error">${this.hass.localize("ui.panel.developer-tools.tabs.actions.no_template_ui_support")}</span>`} </div> <ha-progress-button raised @click="${this._callService}"> ${this.hass.localize("ui.panel.developer-tools.tabs.actions.call_service")} </ha-progress-button> </div> </div> ${this._response?l.qy`<div class="content"> <ha-card .header="${this.hass.localize("ui.panel.developer-tools.tabs.actions.response")}"> <div class="card-content"> <ha-yaml-editor .hass="${this.hass}" copyClipboard readOnly="readOnly" autoUpdate hasExtraActions .value="${this._response}"> <ha-button slot="extra-actions" @click="${this._copyTemplate}">${this.hass.localize("ui.panel.developer-tools.tabs.actions.copy_clipboard_template")}</ha-button> </ha-yaml-editor> </div> </ha-card> </div>`:l.s6} ${(this._yamlMode?t:this._filterSelectorFields(t)).length?l.qy`<div class="content"> <ha-expansion-panel .header="${this._yamlMode?this.hass.localize("ui.panel.developer-tools.tabs.actions.all_parameters"):this.hass.localize("ui.panel.developer-tools.tabs.actions.yaml_parameters")}" outlined .expanded="${this._yamlMode}"> ${this._yamlMode?l.qy`<div class="description"> <h3> ${e?l.qy` ${this.hass.localize("ui.panel.developer-tools.tabs.actions.accepts_target")} `:""} </h3> ${this._serviceData?.action?l.qy` <a href="${(0,g.o)(this.hass,"/integrations/"+(0,h.m)(this._serviceData?.action))}" title="${this.hass.localize("ui.components.service-control.integration_doc")}" target="_blank" rel="noreferrer"> <ha-icon-button class="help-icon" .path="${"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"}" .label="${this.hass.localize("ui.common.help")}"></ha-icon-button> </a>`:""} </div>`:""} <table class="attributes"> <tr> <th> ${this.hass.localize("ui.panel.developer-tools.tabs.actions.column_parameter")} </th> <th> ${this.hass.localize("ui.panel.developer-tools.tabs.actions.column_description")} </th> <th> ${this.hass.localize("ui.panel.developer-tools.tabs.actions.column_example")} </th> </tr> ${(this._yamlMode?t:this._filterSelectorFields(t)).map((e=>l.qy` <tr> <td><pre>${e.key}</pre></td> <td> ${this.hass.localize(`component.${a}.services.${i}.fields.${e.key}.description`)||e.description} </td> <td> ${this.hass.localize(`component.${a}.services.${i}.fields.${e.key}.example`)||e.example} </td> </tr>`))} </table> ${this._yamlMode?l.qy`<mwc-button @click="${this._fillExampleData}">${this.hass.localize("ui.panel.developer-tools.tabs.actions.fill_example_data")}</mwc-button>`:""} </ha-expansion-panel> </div>`:""} `}},{kind:"method",key:"_copyTemplate",value:async function(){await(0,m.l)(`{% set ${this._serviceData?.response_variable||"action_response"} = ${JSON.stringify(this._response)} %}`),(0,_.P)(this,{message:this.hass.localize("ui.common.copied_clipboard")})}},{kind:"field",key:"_filterSelectorFields",value:()=>(0,c.A)((e=>e.filter((e=>!e.selector))))},{kind:"field",key:"_validateServiceData",value:()=>(e,t,a,i,s)=>{const o=i?"yaml":"ui";if(!e?.action)return s(`ui.panel.developer-tools.tabs.actions.errors.${o}.no_action`);const r=(0,h.m)(e.action),l=(0,v.Y)(e.action);if(!r||!l)return s(`ui.panel.developer-tools.tabs.actions.errors.${o}.invalid_action`);if(a&&!e.target&&!e.data?.entity_id&&!e.data?.device_id&&!e.data?.area_id)return s(`ui.panel.developer-tools.tabs.actions.errors.${o}.no_target`);for(const a of t)if(a.required&&(!e.data||void 0===e.data[a.key]))return s(`ui.panel.developer-tools.tabs.actions.errors.${o}.missing_required_field`,{key:a.key})}},{kind:"field",key:"_fields",value:()=>(0,c.A)(((e,t)=>{if(!t)return{target:!1,fields:[]};const a=(0,h.m)(t),i=(0,v.Y)(t);if(!(a in e))return{target:!1,fields:[]};if(!(i in e[a]))return{target:!1,fields:[]};const s="target"in e[a][i],o=e[a][i].fields;return{target:s,fields:Object.keys(o).map((e=>({key:e,...o[e]})))}}))},{kind:"method",key:"_callService",value:async function(e){const t=e.currentTarget;if(this._yamlMode&&!this._yamlValid)return(0,y.j)("failure"),t.actionError(),void(this._error=this.hass.localize("ui.panel.developer-tools.tabs.actions.errors.yaml.invalid_yaml"));const{target:a,fields:i}=this._fields(this.hass.services,this._serviceData?.action);if(this._error=this._validateServiceData(this._serviceData,i,a,this._yamlMode,this.hass.localize),void 0!==this._error)return(0,y.j)("failure"),void t.actionError();const[s,r]=this._serviceData.action.split(".",2),l=[];this.hass.services?.[s]?.[r]&&"response"in this.hass.services[s][r]?(l.push({...this._serviceData,response_variable:"service_result"}),l.push({stop:"done",response_variable:"service_result"})):l.push(this._serviceData);try{this._response=(await(0,b.d)(this.hass,l)).response}catch(e){if(e.error?.code===o.UD&&(0,b.C)(s,r))return;let a;if((0,y.j)("failure"),t.actionError(),e.translation_domain&&e.translation_key){a=(await this.hass.loadBackendTranslation("exceptions",e.translation_domain))(`component.${e.translation_domain}.exceptions.${e.translation_key}.message`,e.translation_placeholders)}return void(this._error=a||this.hass.localize("ui.notification_toast.action_failed",{service:this._serviceData.action})+` ${e.message}`)}t.actionSuccess()}},{kind:"method",key:"_toggleYaml",value:function(){this._yamlMode=!this._yamlMode,this._yamlValid=!0,this._error=void 0}},{kind:"method",key:"_yamlChanged",value:function(e){e.detail.isValid?(this._yamlValid=!0,this._serviceDataChanged(e)):this._yamlValid=!1}},{kind:"method",key:"_checkUiSupported",value:function(){const e=this._fields(this.hass.services,this._serviceData?.action).fields;this._serviceData&&(Object.entries(this._serviceData).some((([e,t])=>"data"!==e&&(0,p.r)(t)))||this._serviceData.data&&Object.entries(this._serviceData.data).some((([t,a])=>{const i=e.find((e=>e.key===t));return(!i?.selector||!("template"in i.selector)&&!("object"in i.selector))&&(0,p.r)(a)})))?(this._yamlMode=!0,this._uiAvailable=!1):this._uiAvailable=!0}},{kind:"method",key:"_serviceDataChanged",value:function(e){this._serviceData?.action!==e.detail.value.action&&(this._error=void 0),this._serviceData=(0,f.Rn)(e.detail.value),this._checkUiSupported()}},{kind:"method",key:"_serviceChanged",value:function(e){e.stopPropagation(),this._serviceData={action:e.detail.value||"",data:{}},this._response=void 0,this._error=void 0,this._yamlEditor?.setValue(this._serviceData),this._checkUiSupported()}},{kind:"method",key:"_fillExampleData",value:function(){const{fields:e}=this._fields(this.hass.services,this._serviceData?.action),t=this._serviceData?.action?(0,h.m)(this._serviceData?.action):void 0,a=this._serviceData?.action?(0,v.Y)(this._serviceData?.action):void 0,i={};e.forEach((e=>{if(e.example){let s="";try{s=(0,r.load)(e.example)}catch(i){s=this.hass.localize(`component.${t}.services.${a}.fields.${e.key}.example`)||e.example}i[e.key]=s}})),this._serviceData={...this._serviceData,data:i},this._yamlEditor?.setValue(this._serviceData),this._checkUiSupported()}},{kind:"get",static:!0,key:"styles",value:function(){return[k.RF,l.AH`.content{padding:16px;padding:max(16px,env(safe-area-inset-top)) max(16px,env(safe-area-inset-right)) max(16px,env(safe-area-inset-bottom)) max(16px,env(safe-area-inset-left));max-width:1200px;margin:auto}.button-row{padding:8px 16px;padding:max(8px,env(safe-area-inset-top)) max(16px,env(safe-area-inset-right)) max(8px,env(safe-area-inset-bottom)) max(16px,env(safe-area-inset-left));border-top:1px solid var(--divider-color);border-bottom:1px solid var(--divider-color);background:var(--card-background-color);position:sticky;bottom:0;box-sizing:border-box;width:100%}.button-row .buttons{display:flex;justify-content:space-between;max-width:1200px;margin:auto}.switch-mode-container{display:flex;align-items:center}.switch-mode-container .error{margin-left:8px;margin-inline-start:8px;margin-inline-end:initial}.attributes{width:100%}.attributes th{text-align:var(--float-start);background-color:var(--card-background-color);border-bottom:1px solid var(--primary-text-color);direction:var(--direction)}.attributes tr{vertical-align:top;direction:ltr}.attributes tr:nth-child(odd){background-color:var(--table-row-background-color,#eee)}.attributes tr:nth-child(2n){background-color:var(--table-row-alternative-background-color,#eee)}.attributes td:nth-child(3){white-space:pre-wrap;word-break:break-word}.attributes td{padding:4px;vertical-align:middle}.help-icon{color:var(--secondary-text-color)}.description{justify-content:space-between;display:flex;align-items:center}`]}}]}}),l.WF)}};
//# sourceMappingURL=22660.OionwyZfkbk.js.map