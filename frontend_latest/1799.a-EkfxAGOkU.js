export const id=1799;export const ids=[1799];export const modules={46999:(t,e,a)=>{a.d(e,{Vy:()=>i,fI:()=>d});var s=a(45253);const n=["#44739e","#984ea3","#00d2d5","#ff7f00","#af8d00","#7f80cd","#b3e900","#c42e60","#a65628","#f781bf","#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#fccde5","#bc80bd","#ffed6f","#c4eaff","#cf8c00","#1b9e77","#d95f02","#e7298a","#e6ab02","#a6761d","#0097ff","#00d067","#f43600","#4ba93b","#5779bb","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function i(t){return n[t%n.length]}function d(t,e){const a=e.getPropertyValue(`--graph-color-${t+1}`)||i(t);return(0,s.RQ)(a)}},56136:(t,e,a)=>{a.d(e,{a:()=>s});const s=t=>!(t.native instanceof MouseEvent)||t.native instanceof PointerEvent&&"mouse"!==t.native.pointerType},1799:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:()=>S});var n=a(36312),i=(a(89655),a(253),a(2075),a(54846),a(16891),a(79784)),d=a(75697),o=a(50289),c=a(29818),r=a(85323),h=a(94100),u=a(46999),l=a(23469),f=(a(13082),a(47076)),p=a(4826),_=a(20712),k=a(7934),m=a(37334),v=a(34897),y=a(96979),b=a(56136),g=t([f,m]);[f,m]=g.then?(await g)():g;const x="kWh";let S=(0,n.A)([(0,c.EM)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,c.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_chartData",value:()=>({datasets:[]})},{kind:"field",decorators:[(0,c.wk)()],key:"_chartDatasetExtra",value:()=>[]},{kind:"field",decorators:[(0,c.wk)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_start",value:()=>(0,i.R)()},{kind:"field",decorators:[(0,c.wk)()],key:"_end",value:()=>(0,d.o)()},{kind:"field",decorators:[(0,c.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,y.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],key:"_hiddenStats",value:()=>[]},{kind:"field",key:"_untrackedIndex",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,f.tb)(this.hass,{key:this._config?.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,k.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?o.qy` <ha-card> ${this._config.title?o.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,r.H)({"has-header":!!this._config.title})}"> <ha-chart-base externalHidden .hass="${this.hass}" .data="${this._chartData}" .extraData="${this._chartDatasetExtra}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,x,this._compareStart,this._compareEnd)}" chart-type="bar" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `:o.s6}},{kind:"method",key:"_datasetHidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=[...this._hiddenStats,e]}},{kind:"method",key:"_datasetUnhidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=this._hiddenStats.filter((t=>t!==e))}},{kind:"field",key:"_createOptions",value(){return(0,h.A)(((t,e,a,s,n,i,d)=>{const o=(0,m.o)(t,e,a,s,n,i,d);return{...o,interaction:{mode:"nearest"},plugins:{...o.plugins,legend:{display:!0,labels:{usePointStyle:!0}}},onClick:(t,e,a)=>{if((0,b.a)(t))return;const s=e[0]?.datasetIndex??-1;if(s<0)return;const n=this._data?.prefs.device_consumption[s]?.stat_consumption;n&&!(0,p.OQ)(n)&&((0,v.r)(this,"hass-more-info",{entityId:n}),a?.canvas?.dispatchEvent(new Event("mouseout")))}}}))}},{kind:"method",key:"_processStatistics",value:function(){const t=this._data,e=t.stats,a=t.statsCompare,s=getComputedStyle(this),n={};t.prefs.device_consumption.forEach((t=>{const a=t.stat_consumption in e&&(0,p.$j)(e[t.stat_consumption])||0;n[t.stat_consumption]=a}));const i=t.prefs.device_consumption.map((t=>t.stat_consumption));i.sort(((t,e)=>n[e]-n[t]));const o=[],c=[],{data:r,dataExtras:h}=this._processDataSet(s,e,t.statsMetadata,t.prefs.device_consumption,i);o.push(...r),c.push(...h);const{summedData:u,compareSummedData:l}=(0,f.gv)(t),_="from_grid"in u||"solar"in u||"from_battery"in u,{consumption:k,compareConsumption:m}=_?(0,f.DR)(u,l):{consumption:void 0,compareConsumption:void 0};if(_){this._untrackedIndex=o.length;const{dataset:t,datasetExtra:e}=this._processUntracked(s,r,k,!1);o.push(t),c.push(e)}if(a){o.push({order:0,data:[]}),c.push({show_legend:!1}),o.push({order:999,data:[],xAxisID:"xAxisCompare"}),c.push({show_legend:!1});const{data:e,dataExtras:n}=this._processDataSet(s,a,t.statsMetadata,t.prefs.device_consumption,i,!0);if(o.push(...e),c.push(...n),_){const{dataset:t,datasetExtra:a}=this._processUntracked(s,e,m,!0);o.push(t),c.push(a)}}this._start=t.start,this._end=t.end||(0,d.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:o},this._chartDatasetExtra=c}},{kind:"method",key:"_processUntracked",value:function(t,e,a,s){const n={};e.forEach((t=>{t.data.forEach((t=>{n[t.x]=(n[t.x]||0)+t.y}))}));const i=[];Object.keys(a.total).forEach((t=>{i.push({x:Number(t),y:a.total[t]-(n[t]||0)})}));return{dataset:{label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),hidden:this._hiddenStats.includes("untracked"),borderColor:(0,l.g)(t,this.hass.themes.darkMode,!1,s,"--state-unavailable-color"),backgroundColor:(0,l.g)(t,this.hass.themes.darkMode,!0,s,"--state-unavailable-color"),data:i,order:1+this._untrackedIndex,stack:"devices",pointStyle:!s&&"circle",xAxisID:s?"xAxisCompare":void 0},datasetExtra:{show_legend:!s}}}},{kind:"method",key:"_processDataSet",value:function(t,e,a,s,n,i=!1){const d=[],o=[];return s.forEach(((s,c)=>{const r=(0,u.fI)(c,t);let h=null;const l=[];if(s.stat_consumption in e){const t=e[s.stat_consumption];let a;for(const e of t){if(null===e.change||void 0===e.change)continue;if(h===e.start)continue;const t=new Date(e.start);l.push({x:t.getTime(),y:e.change}),h=e.start,a=e.end}1===l.length&&l.push({x:a,y:0})}const f=n.indexOf(s.stat_consumption),_=!!(this._config?.max_devices&&f>=this._config.max_devices);d.push({label:s.name||(0,p.$O)(this.hass,s.stat_consumption,a[s.stat_consumption]),hidden:this._hiddenStats.includes(s.stat_consumption)||_,borderColor:i?r+"7F":r,backgroundColor:i?r+"32":r+"7F",data:l,order:1+f,stack:"devices",pointStyle:!i&&"circle",xAxisID:i?"xAxisCompare":void 0}),o.push({show_legend:!i&&!_})})),{data:d,dataExtras:o}}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`}}]}}),(0,_.E)(o.WF));s()}catch(t){s(t)}}))}};
//# sourceMappingURL=1799.a-EkfxAGOkU.js.map