export const id=18862;export const ids=[18862];export const modules={10469:(e,t,o)=>{o.d(t,{$:()=>s});o(89655);const s=(e,t)=>{const o={};for(const s of e){const e=t(s);e in o?o[e].push(s):o[e]=[s]}return o}},47076:(e,t,o)=>{o.a(e,(async(e,s)=>{try{o.d(t,{AN:()=>A,B2:()=>$,BV:()=>P,DR:()=>X,E$:()=>O,GW:()=>M,KJ:()=>R,Q4:()=>E,RB:()=>D,WN:()=>q,X4:()=>K,_d:()=>N,al:()=>F,bs:()=>z,c:()=>W,gv:()=>U,m7:()=>C,oU:()=>S,tb:()=>H,uh:()=>T,yM:()=>I});o(89655),o(253),o(54846),o(16891);var n=o(31195),r=o(77301),a=o(91103),i=o(39902),c=o(72730),l=o(61310),_=o(31293),f=o(63165),u=o(60132),d=o(83324),g=o(84280),y=o(94100),m=o(78691),h=o(41924),p=o(10469),k=o(31265),v=o(4826),b=e([m,h]);[m,h]=b.then?(await b)():b;const w=[],C=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),D=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),T=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),E=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),S=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),W=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),M=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=e=>e.callWS({type:"energy/info"}),$=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),z=e=>e.callWS({type:"energy/get_prefs"}),q=async(e,t)=>{const o=e.callWS({type:"energy/save_prefs",...t});return j(e),o},x=async(e,t,o,s,n,r="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:n?.toISOString(),energy_statistic_ids:o,co2_statistic_id:s,period:r}),O=e=>(0,p.$)(e.energy_sources,(e=>e.type)),A=(e,t,o)=>{const s=[];for(const n of e.energy_sources)if(!o||o.includes(n.type))if("solar"!==n.type)if("gas"!==n.type&&"water"!==n.type)if("battery"!==n.type){for(const e of n.flow_from){s.push(e.stat_energy_from),e.stat_cost&&s.push(e.stat_cost);const o=t.cost_sensors[e.stat_energy_from];o&&s.push(o)}for(const e of n.flow_to){s.push(e.stat_energy_to),e.stat_compensation&&s.push(e.stat_compensation);const o=t.cost_sensors[e.stat_energy_to];o&&s.push(o)}}else s.push(n.stat_energy_from),s.push(n.stat_energy_to);else{s.push(n.stat_energy_from),n.stat_cost&&s.push(n.stat_cost);const e=t.cost_sensors[n.stat_energy_from];e&&s.push(e)}else s.push(n.stat_energy_from);return o&&!o.includes("device")||s.push(...e.device_consumption.map((e=>e.stat_consumption))),s},Y=async(e,t,o,s,f)=>{const[u,d]=await Promise.all([(0,k.VN)(e,{domain:"co2signal"}),P(e)]),g=u.length?u[0]:void 0;let y;if(g)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const o=e.states[t.entity_id];if(o&&"%"===o.attributes.unit_of_measurement){y=o.entity_id;break}}const h=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)h.push(t.stat_energy_from);const p=A(t,d,["grid","solar","battery","gas","device"]),b=A(t,d,["water"]),w=[...p,...b],C=(0,n.c)(s||new Date,o),D=C>35?"month":C>2?"day":"hour",T=e.config.unit_system.length||"",E={energy:"kWh",volume:"km"===T?"m続":"ft続"},S={volume:"km"===T?"L":"gal"},W=p.length?(0,v.sz)(e,o,s,p,D,E,["change"]):{},M=b.length?(0,v.sz)(e,o,s,b,D,S,["change"]):{};let $,z,q,O,Y,j={},B={};f&&(z=(0,m.xo)(o,r.e,e.locale,e.config)&&(0,m.xo)(s||new Date,a.c,e.locale,e.config)?(0,m.ol)(o,i.P,e.locale,e.config,-(0,m.EO)(s||new Date,o,c.W,e.locale,e.config)-1):(0,m.ol)(o,l.f,e.locale,e.config,-1*(C+1)),q=(0,_.A)(o,-1),p.length&&(j=(0,v.sz)(e,z,q,p,D,E,["change"])),b.length&&(B=(0,v.sz)(e,z,q,b,D,S,["change"]))),void 0!==y&&(O=x(e,o,h,y,s,C>35?"month":C>2?"day":"hour"),f&&(Y=x(e,z,h,y,q,C>35?"month":C>2?"day":"hour")));const H={},F=w.length?(0,v.Wr)(e,w):[],[L,N,R,I,K,U,V]=await Promise.all([W,M,j,B,F,O,Y]),X={...L,...N};f&&($={...R,...I}),w.length&&K.forEach((e=>{H[e.statistic_id]=e}));return{start:o,end:s,startCompare:z,endCompare:q,info:d,prefs:t,stats:X,statsMetadata:H,statsCompare:$,co2SignalConfigEntry:g,co2SignalEntity:y,fossilEnergyConsumption:U,fossilEnergyConsumptionCompare:V}},j=e=>{w.forEach((t=>{const o=H(e,{key:t});o.clearPrefs(),o._active&&o.refresh()}))},B=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},H=(e,t={})=>{let o="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");o=`_${t.key}`}if(e.connection[o])return e.connection[o];w.push(t.key);const s=(0,g.X)(e.connection,o,(async()=>(s.prefs||(s.prefs=await z(e)),B(s),Y(e,s.prefs,s.start,s.end,s.compare)))),n=s.subscribe;s.subscribe=e=>{const t=n(e);return s._active++,void 0===s._refreshTimeout&&B(s),()=>{s._active--,s._active<1&&(clearTimeout(s._refreshTimeout),s._refreshTimeout=void 0),t()}},s._active=0,s.prefs=t.prefs;const r=new Date,a=(0,h.LW)(r,e.locale,e.config).split(":")[0];s.start=(0,m.ol)("0"===a?(0,l.f)(r,-1):r,f.o,e.locale,e.config),s.end=(0,m.ol)("0"===a?(0,l.f)(r,-1):r,u.D,e.locale,e.config);const i=()=>{s._updatePeriodTimeout=window.setTimeout((()=>{s.start=(0,m.ol)(new Date,f.o,e.locale,e.config),s.end=(0,m.ol)(new Date,u.D,e.locale,e.config),i()}),(0,d.L)((0,m.ol)(r,u.D,e.locale,e.config),1).getTime()-Date.now())};return i(),s.clearPrefs=()=>{s.prefs=void 0},s.setPeriod=(t,o)=>{s.start=t,s.end=o,s.start.getTime()!==(0,m.ol)(new Date,f.o,e.locale,e.config).getTime()||s.end?.getTime()!==(0,m.ol)(new Date,u.D,e.locale,e.config).getTime()||s._updatePeriodTimeout?s._updatePeriodTimeout&&(clearTimeout(s._updatePeriodTimeout),s._updatePeriodTimeout=void 0):i()},s.setCompare=e=>{s.compare=e},s},F=e=>e.callWS({type:"energy/solar_forecast"}),L=["volume","energy"],N=(e,t={},o)=>{for(const s of e.energy_sources){if("gas"!==s.type)continue;if(o&&o===s.stat_energy_from)continue;const e=t[s.stat_energy_from];if(L.includes(e?.unit_class))return e.unit_class}},R=(e,t,o={})=>{const s=N(t,o);if(void 0!==s)return"energy"===s?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},I=e=>"km"===e.config.unit_system.length?"L":"gal",K="/docs/energy/faq/#troubleshooting-missing-entities",U=(0,y.A)((e=>({summedData:V(e),compareSummedData:e.statsCompare?V(e,!0):void 0}))),V=(e,t)=>{const o={};for(const t of e.prefs.energy_sources)if("solar"!==t.type)if("battery"!==t.type){if("grid"===t.type){for(const e of t.flow_from)o.from_grid?o.from_grid.push(e.stat_energy_from):o.from_grid=[e.stat_energy_from];for(const e of t.flow_to)o.to_grid?o.to_grid.push(e.stat_energy_to):o.to_grid=[e.stat_energy_to]}}else o.to_battery?(o.to_battery.push(t.stat_energy_to),o.from_battery.push(t.stat_energy_from)):(o.to_battery=[t.stat_energy_to],o.from_battery=[t.stat_energy_from]);else o.solar?o.solar.push(t.stat_energy_from):o.solar=[t.stat_energy_from];const s={};return Object.entries(o).forEach((([o,n])=>{const r={},a={};n.forEach((o=>{const s=t?e.statsCompare[o]:e.stats[o];if(!s)return;s.forEach((e=>{if(null===e.change||void 0===e.change)return;const t=e.change;r[e.start]=e.start in r?r[e.start]+t:t})),a[o]={}})),s[o]=r})),s},X=(0,y.A)(((e,t)=>({consumption:Z(e),compareConsumption:t?Z(t):void 0}))),Z=e=>{const t={total:{}};return Object.keys(e).forEach((o=>{Object.keys(e[o]).forEach((o=>{if(void 0===t.total[o]){const s=(e.from_grid?.[o]||0)+(e.solar?.[o]||0)+(e.from_battery?.[o]||0)-(e.to_grid?.[o]||0)-(e.to_battery?.[o]||0);t.total[o]=s}}))})),t};s()}catch(e){s(e)}}))},18862:(e,t,o)=>{o.a(e,(async(e,s)=>{try{o.r(t),o.d(t,{HuiEnergyCompareCard:()=>g});var n=o(36312),r=o(31195),a=o(60132),i=o(50289),c=o(29818),l=o(57289),_=o(47076),f=o(20712),u=o(7934),d=e([l,_]);[l,_]=d.then?(await d)():d;let g=(0,n.A)([(0,c.EM)("hui-energy-compare-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,c.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_start",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_end",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_startCompare",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_endCompare",value:void 0},{kind:"field",decorators:[(0,c.MZ)({type:Boolean,reflect:!0})],key:"hidden",value:()=>!0},{kind:"method",key:"getCardSize",value:function(){return 1}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,_.tb)(this.hass,{key:this._config.collection_key}).subscribe((e=>this._update(e)))]}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,u.xP)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){if(!this._startCompare||!this._endCompare)return i.s6;const e=(0,r.c)(this._endCompare,this._startCompare);return i.qy` <ha-alert dismissable @alert-dismissed-clicked="${this._stopCompare}"> ${this.hass.localize("ui.panel.energy.compare.info",{start:i.qy`<b>${(0,l.Yq)(this._start,this.hass.locale,this.hass.config)}${e>0?` -\n          ${(0,l.Yq)(this._end||(0,a.D)(new Date),this.hass.locale,this.hass.config)}`:""}</b>`,end:i.qy`<b>${(0,l.Yq)(this._startCompare,this.hass.locale,this.hass.config)}${e>0?` -\n          ${(0,l.Yq)(this._endCompare,this.hass.locale,this.hass.config)}`:""}</b>`})} </ha-alert> `}},{kind:"method",key:"_update",value:function(e){this._start=e.start,this._end=e.end,this._startCompare=e.startCompare,this._endCompare=e.endCompare,this.hidden=!this._startCompare}},{kind:"method",key:"_stopCompare",value:function(){const e=(0,_.tb)(this.hass,{key:this._config.collection_key});e.setCompare(!1),e.refresh()}},{kind:"get",static:!0,key:"styles",value:function(){return i.AH`mwc-button{width:max-content}`}}]}}),(0,f.E)(i.WF));s()}catch(e){s(e)}}))},24226:(e,t,o)=>{o.d(t,{z:()=>n});var s=o(30429);function n(e,t){const o=(0,s.a)(e),n=(0,s.a)(t),r=o.getTime()-n.getTime();return r<0?-1:r>0?1:r}},72730:(e,t,o)=>{o.d(t,{W:()=>i});var s=o(24226),n=o(30429);function r(e,t){const o=(0,n.a)(e),s=(0,n.a)(t);return 12*(o.getFullYear()-s.getFullYear())+(o.getMonth()-s.getMonth())}var a=o(91103);function i(e,t){const o=(0,n.a)(e),i=(0,n.a)(t),c=(0,s.z)(o,i),l=Math.abs(r(o,i));let _;if(l<1)_=0;else{1===o.getMonth()&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-c*l);let t=(0,s.z)(o,i)===-c;(0,a.c)((0,n.a)(e))&&1===l&&1===(0,s.z)(e,i)&&(t=!1),_=c*(l-Number(t))}return 0===_?0:_}},77301:(e,t,o)=>{o.d(t,{e:()=>n});var s=o(30429);function n(e){return 1===(0,s.a)(e).getDate()}},91103:(e,t,o)=>{o.d(t,{c:()=>a});var s=o(60132),n=o(12152),r=o(30429);function a(e){const t=(0,r.a)(e);return+(0,s.D)(t)==+(0,n.p)(t)}}};
//# sourceMappingURL=18862.Hsbv69J3cqM.js.map