export const id=52177;export const ids=[52177];export const modules={77226:(e,t,i)=>{i.d(t,{A:()=>s});const a=e=>{const t=parseFloat(e);if(isNaN(t))throw new Error(`${e} is not a number`);return t};function s(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:a(e.substr(0,e.length-1))};const t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:a(t[0]),h:1}:{w:a(t[0]),h:a(t[1])}}catch(e){}return null}},9755:(e,t,i)=>{i.d(t,{e:()=>a});const a=e=>`/api/image_proxy/${e.entity_id}?token=${e.attributes.access_token}&state=${e.state}`},52177:(e,t,i)=>{i.r(t);var a=i(36312),s=i(68689),o=i(50289),r=i(29818),n=i(10977),d=i(38962),h=i(213),c=i(19244),l=(i(13082),i(9755)),m=i(25319),g=i(18102),u=i(63582),v=i(562),_=i(7934),f=(i(16204),i(46645));(0,a.A)([(0,r.EM)("hui-picture-entity-card")],(function(e,t){class a extends t{constructor(...t){super(...t),e(this)}}return{F:a,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await i.e(97912).then(i.bind(i,97912)),document.createElement("hui-picture-entity-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(e,t,i){return{type:"picture-entity",entity:(0,g.B)(e,1,t,i,["light","switch"])[0]||"",image:"https://demo.home-assistant.io/stub_config/bedroom.png"}}},{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_config",value:void 0},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){if(!e||!e.entity)throw new Error("Entity must be specified");if(!(["camera","image","person"].includes((0,h.m)(e.entity))||e.image||e.state_image||e.camera_image))throw new Error("No image source configured");this._config={show_name:!0,show_state:!0,...e}}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,_.LX)(this,e)}},{kind:"method",key:"updated",value:function(e){if((0,s.A)(a,"updated",this,3)([e]),!this._config||!this.hass)return;const t=e.get("hass"),i=e.get("_config");t&&i&&t.themes===this.hass.themes&&i.theme===this._config.theme||(0,d.Q)(this,this.hass.themes,this._config.theme)}},{kind:"method",key:"render",value:function(){if(!this._config||!this.hass)return o.s6;const e=this.hass.states[this._config.entity];if(!e)return o.qy` <hui-warning> ${(0,f.j)(this.hass,this._config.entity)} </hui-warning> `;const t=this._config.name||(0,c.u)(e),i=this.hass.formatEntityState(e);let a="";this._config.show_name&&this._config.show_state?a=o.qy` <div class="footer both"> <div>${t}</div> <div>${i}</div> </div> `:this._config.show_name?a=o.qy`<div class="footer single">${t}</div>`:this._config.show_state&&(a=o.qy`<div class="footer single">${i}</div>`);const s=(0,h.m)(this._config.entity);let r=this._config.image;switch(s){case"image":r=(0,l.e)(e);break;case"person":e.attributes.entity_picture&&(r=e.attributes.entity_picture)}return o.qy` <ha-card> <hui-image .hass="${this.hass}" .image="${r}" .stateImage="${this._config.state_image}" .stateFilter="${this._config.state_filter}" .cameraImage="${"camera"===s?this._config.entity:this._config.camera_image}" .cameraView="${this._config.camera_view}" .entity="${this._config.entity}" .aspectRatio="${this._config.aspect_ratio}" .fitMode="${this._config.fit_mode}" @action="${this._handleAction}" .actionHandler="${(0,m.T)({hasHold:(0,v.h)(this._config.hold_action),hasDoubleClick:(0,v.h)(this._config.double_tap_action)})}" tabindex="${(0,n.J)((0,v.h)(this._config.tap_action)||this._config.entity?"0":void 0)}"></hui-image> ${a} </ha-card> `}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`ha-card{min-height:75px;overflow:hidden;position:relative;height:100%;box-sizing:border-box}hui-image{cursor:pointer;height:100%}.footer{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:absolute;left:0;right:0;bottom:0;background-color:var(--ha-picture-card-background-color,rgba(0,0,0,.3));padding:16px;font-size:16px;line-height:16px;color:var(--ha-picture-card-text-color,#fff);pointer-events:none}.both{display:flex;justify-content:space-between}.single{text-align:center}`}},{kind:"method",key:"_handleAction",value:function(e){(0,u.$)(this,this.hass,this._config,e.detail.action)}}]}}),o.WF)},16204:(e,t,i)=>{var a=i(36312),s=i(68689),o=(i(253),i(2075),i(50289)),r=i(29818),n=i(85323),d=i(55165),h=i(94872),c=i(213),l=i(77226),m=(i(6188),i(32885),i(88800)),g=i(9883),u=i(9755);var v=function(e){return e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error",e}(v||{});(0,a.A)([(0,r.EM)("hui-image")],(function(e,t){class i extends t{constructor(...t){super(...t),e(this)}}return{F:i,d:[{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"image",value:void 0},{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,r.MZ)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_imageVisible",value:()=>!1},{kind:"field",decorators:[(0,r.wk)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:()=>null},{kind:"method",key:"connectedCallback",value:function(){(0,s.A)(i,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=v.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,s.A)(i,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(e){if(e.has("hass")){const t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=v.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,l.A)(this.aspectRatio):null),this._loadState!==v.Loading||this.cameraImage||(this._loadState=v.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return o.s6;const e=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),t=this.entity?this.hass.states[this.entity]:void 0,i=t?t.state:g.Hh;let a,s,r=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?s=this.hass.states[this.cameraImage]:a=this._cameraImageSrc;else if(this.stateImage){const e=this.stateImage[i];e?a=e:(a=this.image,r=!0)}else a=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:t&&"image"===(0,c.m)(t.entity_id)?(0,u.e)(t):this.image;a&&(a=this.hass.hassUrl(a));let l=this.filter||"";if(this.hass.themes.darkMode&&this.darkModeFilter&&(l+=this.darkModeFilter),this.stateFilter&&this.stateFilter[i]&&(l+=this.stateFilter[i]),!l&&this.entity){l=(!t||h.jj.includes(i))&&r?"grayscale(100%)":""}return o.qy` <div style="${(0,d.W)({paddingBottom:e?`${(100*this._ratio.h/this._ratio.w).toFixed(2)}%`:void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:e&&this._loadedImageSrc?`url("${this._loadedImageSrc}")`:void 0,filter:this._loadState===v.Loaded||"live"===this.cameraView?l:void 0})}" class="container ${(0,n.H)({ratio:e||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode})}"> ${this.cameraImage&&"live"===this.cameraView?o.qy` <ha-camera-stream muted .hass="${this.hass}" .stateObj="${s}" @load="${this._onVideoLoad}"></ha-camera-stream> `:void 0===a?o.s6:o.qy` <img id="image" src="${a}" @error="${this._onImageError}" @load="${this._onImageLoad}" style="${(0,d.W)({display:e||this._loadState===v.Loaded?"block":"none"})}"> `} ${this._loadState===v.Error?o.qy`<div id="brokenImage" style="${(0,d.W)({height:e?void 0:`${this._lastImageHeight}px`||"100%"})}"></div>`:"live"===this.cameraView||void 0!==a&&this._loadState!==v.Loading?"":o.qy`<div class="progress-container" style="${(0,d.W)({height:e?void 0:`${this._lastImageHeight}px`||"100%"})}"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>`} </div> `}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((()=>this._updateCameraImageSrcAtInterval()),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=v.Error}},{kind:"method",key:"_onImageLoad",value:async function(e){this._loadState=v.Loaded;const t=e.target;this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=t.src),await this.updateComplete,this._lastImageHeight=t.offsetHeight}},{kind:"method",key:"_onVideoLoad",value:async function(e){this._loadState=v.Loaded;const t=e.currentTarget;await this.updateComplete,this._lastImageHeight=t.offsetHeight}},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:async function(){return this._loadState===v.Loading&&this._onImageError(),this._updateCameraImageSrc()}},{kind:"method",key:"_updateCameraImageSrc",value:async function(){if(!this.hass||!this.cameraImage)return;if(!this.hass.states[this.cameraImage])return void this._onImageError();const e=this.clientWidth||640;let t,i=Math.ceil(e*devicePixelRatio);this._lastImageHeight?t=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?t=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,t=Math.ceil(.5625*i)),this._cameraImageSrc=await(0,m.C4)(this.hass,this.cameraImage,i,t),void 0===this._cameraImageSrc&&this._onImageError()}},{kind:"get",static:!0,key:"styles",value:function(){return o.AH`:host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}`}}]}}),o.WF)}};
//# sourceMappingURL=52177.xBiNgeAyLYQ.js.map